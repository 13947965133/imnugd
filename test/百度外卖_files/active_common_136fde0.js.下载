define("mwaimai:widget/brand/common/activeLocation/location_h5.js",function(t,a,o){var i=t("mwaimai:static/utils/stat.js"),s=function(){this.opts={enableHighAcuracy:!0,timeout:5e3}};s.prototype.locate=function(t,a){var o=this;lbstag&&lbstag.geolocation.getCurrentPosition(function(s){s?(i.addStat("SAK",{da_trd:"waimai",da_src:"MwaimaiConfrimAddressPg.H5getPosition.Success",da_act:"show"}),o.getAddressByBaidu(s,t,a)):(i.addStat("SAK",{da_trd:"waimai",da_src:"MwaimaiConfrimAddressPg.H5getPosition.Fail",da_act:"show"}),a&&a())},function(t){a&&a(t)},o.opts)},s.prototype.getAddressByBaidu=function(t,a,o){$.ajax({url:"/shopui/api/geo",type:"GET",dataType:"json",data:{lat:t.coords.y,lng:t.coords.x,display:"json"},success:function(o){if(o){var i={};i.address=o.result.poi_address,i.lat=t.coords.y,i.lng=t.coords.x,a(i)}},error:function(){o&&o(),alert("网络异常，请稍后重试")}})},o.exports=new s});
;define("mwaimai:widget/brand/common/activeLocation/location.js",function(t,o,i){var n=(t("mwaimai:static/utils/stat.js"),t("mwaimai:static/utils/Cookie.js")),a=t("mwaimai:static/utils/CookieDataCenter.js"),s=t("mwaimai:widget/common/location/positionManager/positionManager.js"),e=t("mwaimai:static/utils.js"),r=t("mwaimai:widget/brand/common/activeLocation/location_h5.js"),c=t("mwaimai:static/bridge/NABridge.js");i.exports=Widget.extend({el:"#location-searchbox",events:{'click [data-node="changeCity"]':"_changeCity"},channels:{"activity.common.location changeIcon":"_changeIcon"},init:function(t){this.useUrlGeo=t||0;var o=this;this.judgeNa(),this.initUrlParams(),setTimeout(function(){o._fngetAddr()},100)},getBoxLocation:function(){var t=window.Box&&Box.isBox;if(t){var o="BAIDULOC",i=n.get(o).split("_"),a=i&&i.length>=2,s=a?i[0]:"",e=a?i[1]:"";return self.$dom.changeCity.hide(),e&&s?{lat:e,lng:s}:void 0}},judgeNa:function(){var t=this;c.openInUrl("getAppVersion","",function(o){window.appversion=o.result,t.$dom.changeCity.hide()})},initUrlParams:function(){this.params={channel:"",needlocation:"",lat:"",cityid:"",address:"",type:""},$.extend(this.params,e.getParams())},_changeIcon:function(){$(".shop-list-title img").css("visibility","hidden"),this.$dom.icon.addClass("icon-sug-error").removeClass("icon-location")},_changeCity:function(){var t="https://"+window.location.host+window.location.pathname,o={};$.extend(o,this.params),$.extend(o,{lat:"",lng:""});var i=0;for(var n in o)n&&(t+=(0===i++?"?":"&")+n+"="+o[n]);location.href="/mobile/waimai?qt=confirmcity&url="+encodeURIComponent(t)},_fngetAddr:function(){var t=this,o=this.getBoxLocation();if(o){var i={coords:{x:o.lng,y:o.lat}};return this._getPioAddr(i),void this._renderShopLit()}if(this.params.lat&&this.params.lng&&(window.appversion||this.useUrlGeo)){var i={};return i.coords={},i.coords.y=this.params.lat,i.coords.x=this.params.lng,this._getPioAddr(i),this._renderShopLit(),!1}if(s.getPosition().lat&&a.getAddr().lng){var n={};n.lat=s.getPosition().lat,n.lng=s.getPosition().lng,n.address=s.getPosition().address,t._showLocationIcon(n),t._triggerData(n)}else try{r.locate(function(o){var i={};i.lng=o.lng,i.lat=o.lat,i.address=o.address,t._showLocationIcon(i),t._triggerData(i)},function(){t._showLocationIcon(),t._renderNoShop()})}catch(e){t._renderNoShop()}},_showLocationIcon:function(t){t&&t.address?(this.$dom.icon.removeClass("icon-sug-error").addClass("icon-location"),this.$dom.address.html(t.address)):(this.$dom.icon.addClass("icon-sug-error").removeClass("icon-location"),this.$dom.address.html("无法获取位置,请手动定位"))},_getPioAddr:function(t){var o=this;r.getAddressByBaidu(t,function(i){i.address?o._showLocationIcon(i):o._ajaxAddr(t)},function(){o._ajaxAddr(t)})},_ajaxAddr:function(t){var o=this;$.ajax({url:"https://api.map.baidu.com/?qt=rgc_standard&callback=",data:{x:t.coords.x,y:t.coords.y,dis_poi:"100",poi_num:"10",ie:"utf-8",oue:"1",res:"api"},context:this,dataType:"jsonp",success:function(i){if(!i.content||!i.content.address)return void o._showLocationIcon(t);var n={};n.address=i.content.address,o._showLocationIcon(n)},error:function(){o._showLocationIcon(t)}})},_renderNoShop:function(){this.$dom.icon.addClass("icon-sug-error").removeClass("icon-location"),this.$dom.address.html("无法获取位置,请手动定位"),setTimeout(function(){listener.trigger("activity.common.noShop","no_list")})},_renderShopLit:function(t){setTimeout(function(){listener.trigger("activity.common.shopList","show_list",t)})},_triggerData:function(t){setTimeout(function(){listener.trigger("activity.common.shopData","get_data",t)})}})});
;define("mwaimai:widget/brand/common/dialog/dialog.js",function(i,t,n){function a(){this.cfg={el:".custom-dialog",tpl:"content-tpl",maskTap:!0},this.initialize.apply(this,arguments)}a.prototype={constructor:a,initialize:function(i){var t=this;t.cfg=$.extend(t.cfg,i),t.$el=$(t.cfg.el),t.$el.html(t.cfg.tpl),t.$mask=$("#dialog-mask"),t.$mask.on("tap",function(){t.cfg.maskTap&&t.close()})},show:function(i,t,n){var a=this;"function"===$.type(t)&&(n=t,t={}),a.$mask.show(),a.$mask.animate({opacity:1},150),a.$el.removeClass("hide"),a.$el.html(i[0]({data:t})),a.$el.children(".inner").addClass(i[1]),n&&n(),$(".close").on("tap",function(){a.close()})},close:function(i){var t=this,n=t.$el.children(".inner");n.addClass("bounceOutUp"),n.on("webkitAnimationEnd",function(){t.$el.empty(),t.$mask.animate({opacity:0},150,function(){t.$mask.hide()}),t.$el.addClass("hide")}),i&&i()}},n.exports=a});
;define("mwaimai:widget/brand/common/shopList/list.js",function(require,exports,module){var util=require("mwaimai:static/utils.js"),Stat=require("mwaimai:static/utils/stat.js"),urlOperator=require("mwaimai:widget/common/urlFactory/urlOperator.js"),urlnav=require("mwaimai:comp/urlnav/urlnav.js"),list=[function(_template_object){var _template_fun_array=[],fn=function(__data__){function getIconSrc(e,a){if("logistics"==e)var t="//s.waimai.baidu.com/static/webapp/logistics_s.png";else var t="//waimai.baidu.com/static/forwebapp/"+e+"_"+a+".png";try{"certification"==e&&city_info&&333==city_info.city_id&&(t="//waimai.baidu.com/static/forwebapp/certification_jinhua_"+a+".png")}catch(i){}return t}var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push(""),_template_fun_array.push("");for(var i=0,len=data.length;len>i;i++){var item=data[i];_template_fun_array.push("");var url="/mobile/waimai?qt=shopmenu&shop_id="+item.release_id;if(recall_info){var lat=recall_info.lat,lng=recall_info.lng,addr=recall_info.address;url="/mobile/waimai?qt=shopmenu&shop_id="+item.release_id+"&lat="+lat+"&lng="+lng+"&address="+addr+"&is_attr1"}if(_template_fun_array.push("    "),channel){_template_fun_array.push('<li class="shop-item-wrapper" data-url="',"undefined"==typeof urlnav.thirdParty(item.mapUrl)?"":baidu.template._encodeHTML(urlnav.thirdParty(item.mapUrl)),'" data-id="',"undefined"==typeof item.release_id?"":baidu.template._encodeHTML(item.release_id),'"><a ><div class="list-img"><img src="',"undefined"==typeof item.logo_url?"":baidu.template._encodeHTML(item.logo_url),'" alt="商铺"></div><div class="list-wrapper"><h4 class="text-title">');var wlen=item.welfare_basic_info.length;_template_fun_array.push("");var limit="";switch(wlen){case 0:case 1:case 2:limit="limit-width-9";break;case 3:limit="limit-width-8";break;case 4:limit="limit-width-7";break;case 5:limit="limit-width-6";break;default:limit="limit-width-5"}_template_fun_array.push('<p class="text-ellipsis ',"undefined"==typeof limit?"":baidu.template._encodeHTML(limit),'">',"undefined"==typeof(item.shop_name||"")?"":baidu.template._encodeHTML(item.shop_name||""),"</p><!--     show logos of basic warefare info like pay & invoice    image url rule : basic domin + type + _ + size    field: welfare_basic_info    -->    <p>");for(var j=0;wlen>j;j++){_template_fun_array.push("                    ");var imgUrl=getIconSrc(item.welfare_basic_info[j].type,"b");_template_fun_array.push('                    <img class="welfare-logo" src=',"undefined"==typeof imgUrl?"":baidu.template._encodeHTML(imgUrl),' alt="">                ')}if(_template_fun_array.push('</p></h4><div class="shop-status">'),1==item.bussiness_status?_template_fun_array.push('<span class="status stop">休息中</span>'):2==item.bussiness_status?(_template_fun_array.push('<span class="status order">仅预订</span>'),item.start_time&&_template_fun_array.push('<span class="open">',"undefined"==typeof item.start_time?"":baidu.template._encodeHTML(item.start_time),"开始配送</span>"),_template_fun_array.push("")):3==item.bussiness_status?_template_fun_array.push("<span>已售","undefined"==typeof item.saled?"":baidu.template._encodeHTML(item.saled),"份</span>"):4==item.bussiness_status&&_template_fun_array.push('<span class="status stop">已打烊</span>'),_template_fun_array.push('</div><div class="shop-msg"><span>起送费 ￥',"undefined"==typeof(Math.round(100*Number(item.takeout_price))/100)?"":baidu.template._encodeHTML(Math.round(100*Number(item.takeout_price))/100),"</span><span>配送费 "),item.discount_info&&1==item.discount_info.is_discount_send?_template_fun_array.push("<del>￥0</del>"):_template_fun_array.push("￥","undefined"==typeof(item.takeout_cost||"0")?"":baidu.template._encodeHTML(item.takeout_cost||"0"),""),_template_fun_array.push('</span><span class="">平均',"undefined"==typeof item.delivery_time?"":baidu.template._encodeHTML(item.delivery_time),"分钟送达</span></div>"),item.welfare_act_info.length>0){_template_fun_array.push("    ");var MAX_SHOW_LENGTH=6;_template_fun_array.push('<div class="welfare-act-info" data-node="showWalfareDetail">    <p class="welfare-line">');var wlen=item.welfare_act_info.length>=MAX_SHOW_LENGTH?MAX_SHOW_LENGTH:item.welfare_act_info.length;_template_fun_array.push("");for(var j=0;wlen>j;j++){_template_fun_array.push("                    ");var imgUrl=getIconSrc(item.welfare_act_info[j].type,"b");_template_fun_array.push('                    <img class="welfare-logo" src=',"undefined"==typeof imgUrl?"":baidu.template._encodeHTML(imgUrl),' alt="">                ')}_template_fun_array.push("</p>"),item.welfare_act_info.length>MAX_SHOW_LENGTH&&_template_fun_array.push('<span class="welfare-img-ellipsis">...</span>'),_template_fun_array.push('<label class="youhui"><span>优惠详情</span><i class="icon-arrow-down1" data-node="warefare-detail-director"></i></label></div>')}if(_template_fun_array.push("</div></a>"),item.welfare_act_info.length>0){_template_fun_array.push("<div class='warefare-details-card' data-node=\"warefareDetail\">");var wlen=item.welfare_act_info.length;_template_fun_array.push("");for(var j=0;wlen>j;j++){_template_fun_array.push("                    ");var imgUrl=getIconSrc(item.welfare_act_info[j].type,"s");_template_fun_array.push("            <div class='card-warefare-list'>            <img class=\"welfare-logo-small\" src=","undefined"==typeof imgUrl?"":baidu.template._encodeHTML(imgUrl),' alt="">            '),item.welfare_act_info[j].msg&&_template_fun_array.push("            <span class='msg'>            ","undefined"==typeof item.welfare_act_info[j].msg?"":baidu.template._encodeHTML(item.welfare_act_info[j].msg),"            </span>            "),_template_fun_array.push("            </div>        ")}_template_fun_array.push("</div>")}_template_fun_array.push("</li>")}else{_template_fun_array.push('<li class="shop-item-wrapper" data-url="',"undefined"==typeof urlnav.thirdParty(url)?"":baidu.template._encodeHTML(urlnav.thirdParty(url)),'" data-id="',"undefined"==typeof item.release_id?"":baidu.template._encodeHTML(item.release_id),'"><a ><div class="list-img"><img src="',"undefined"==typeof item.logo_url?"":baidu.template._encodeHTML(item.logo_url),'" alt="商铺"></div><div class="list-wrapper"><h4 class="text-title">');var wlen=item.welfare_basic_info.length;_template_fun_array.push("");var limit="";switch(wlen){case 0:case 1:case 2:limit="limit-width-9";break;case 3:limit="limit-width-8";break;case 4:limit="limit-width-7";break;case 5:limit="limit-width-6";break;default:limit="limit-width-5"}_template_fun_array.push('<p class="text-ellipsis ',"undefined"==typeof limit?"":baidu.template._encodeHTML(limit),'">',"undefined"==typeof(item.shop_name||"")?"":baidu.template._encodeHTML(item.shop_name||""),"</p><!--     show logos of basic warefare info like pay & invoice    image url rule : basic domin + type + _ + size    field: welfare_basic_info    -->    <p>");for(var j=0;wlen>j;j++){_template_fun_array.push("                    ");var imgUrl=getIconSrc(item.welfare_basic_info[j].type,"b");_template_fun_array.push('                    <img class="welfare-logo" src=',"undefined"==typeof imgUrl?"":baidu.template._encodeHTML(imgUrl),' alt="">                ')}if(_template_fun_array.push('</p></h4><div class="shop-status">'),1==item.bussiness_status?_template_fun_array.push('<span class="status stop">休息中</span>'):2==item.bussiness_status?(_template_fun_array.push('<span class="status order">仅预订</span>'),item.start_time&&_template_fun_array.push('<span class="open">',"undefined"==typeof item.start_time?"":baidu.template._encodeHTML(item.start_time),"开始配送</span>"),_template_fun_array.push("")):3==item.bussiness_status?_template_fun_array.push("<span>已售","undefined"==typeof item.saled?"":baidu.template._encodeHTML(item.saled),"份</span>"):4==item.bussiness_status&&_template_fun_array.push('<span class="status stop">已打烊</span>'),_template_fun_array.push('</div><div class="shop-msg"><span>起送费 ￥',"undefined"==typeof(Math.round(100*Number(item.takeout_price))/100)?"":baidu.template._encodeHTML(Math.round(100*Number(item.takeout_price))/100),"</span><span>配送费 "),item.discount_info&&1==item.discount_info.is_discount_send?_template_fun_array.push("<del>￥0</del>"):_template_fun_array.push("￥","undefined"==typeof(parseInt(item.takeout_cost)||"0")?"":baidu.template._encodeHTML(parseInt(item.takeout_cost)||"0"),""),_template_fun_array.push('</span><span class="">平均',"undefined"==typeof item.delivery_time?"":baidu.template._encodeHTML(item.delivery_time),"分钟送达</span></div>"),item.welfare_act_info.length>0){_template_fun_array.push("    ");var MAX_SHOW_LENGTH=6;_template_fun_array.push('<div class="welfare-act-info" data-node="showWalfareDetail">    <p class="welfare-line">');var wlen=item.welfare_act_info.length>=MAX_SHOW_LENGTH?MAX_SHOW_LENGTH:item.welfare_act_info.length;_template_fun_array.push("");for(var j=0;wlen>j;j++){_template_fun_array.push("                    ");var imgUrl=getIconSrc(item.welfare_act_info[j].type,"b");_template_fun_array.push('                    <img class="welfare-logo" src=',"undefined"==typeof imgUrl?"":baidu.template._encodeHTML(imgUrl),' alt="">                ')}_template_fun_array.push("</p>"),item.welfare_act_info.length>MAX_SHOW_LENGTH&&_template_fun_array.push('<span class="welfare-img-ellipsis">...</span>'),_template_fun_array.push('<label class="youhui"><span>优惠详情</span><i class="icon-arrow-down1" data-node="warefare-detail-director"></i></label></div>')}if(_template_fun_array.push("</div></a>"),item.welfare_act_info.length>0){_template_fun_array.push("<div class='warefare-details-card' data-node=\"warefareDetail\">");var wlen=item.welfare_act_info.length;_template_fun_array.push("");for(var j=0;wlen>j;j++){_template_fun_array.push("                    ");var imgUrl=getIconSrc(item.welfare_act_info[j].type,"s");_template_fun_array.push("            <div class='card-warefare-list'>            <img class=\"welfare-logo-small\" src=","undefined"==typeof imgUrl?"":baidu.template._encodeHTML(imgUrl),' alt="">            '),item.welfare_act_info[j].msg&&_template_fun_array.push("            <span class='msg'>            ","undefined"==typeof item.welfare_act_info[j].msg?"":baidu.template._encodeHTML(item.welfare_act_info[j].msg),"            </span>            "),_template_fun_array.push("            </div>        ")}_template_fun_array.push("</div>")}_template_fun_array.push("</li>")}_template_fun_array.push("")}_template_fun_array.push(""),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],client=util.getParam("client"),channel=util.getParam("channel"),isnuomi="nuomi"===client;if(!isnuomi)var NABridge=require("mwaimai:static/bridge/NABridge.js");var self=this;module.exports=Widget.extend({el:"#shop-list-container",channels:{"activity.common.shopList show_list":"_renderShopLit","activity.common.noShop no_list":"_renderNoShop","activity.common.shopData get_data":"_getDataByAjax"},init:function(e){self=this,this.config=e.config,this.data=e.data,!isnuomi&&NABridge.openInUrl("getAppVersion","",function(e){window.appversion=e.result})},bindEvent:function(){var e=this;$(".shop-item-wrapper").off("click"),$(".shop-item-wrapper").on("click",function(){e.jumpDetail(this)}),$("label.youhui").on("click"),$("label.youhui").on("click",function(a){e.toggleCoupon(a,this)})},toggleCoupon:function(e,a){e.stopPropagation(),e.preventDefault(),$(a).parents(".shop-item-wrapper").find(".warefare-details-card").toggle()},jumpDetail:function(e){var a=$(e).attr("data-id"),t=$(e).data("url"),i=function(e){e&&"function"==typeof e&&(window.BNJS&&"object"==typeof window.BNJS&&window.BNJS._isAllReady?e():document.addEventListener("BNJSReady",function(){e()},!1))};if(Stat.addStat("SAK",this.config.clickShopStat),!isnuomi&&window.appversion)NABridge.openInUrl("jumpToShopMenu",{release_id:a,shop_id:a},"");else if(isnuomi&&window.BNJS&&window.BNJS.page&&window.BNJS.page.start)i(function(){var e="bainuo://component?compid=waimai&comppage=shopmenu",t={shop_id:a};BNJS.page.start(e,t)});else if(window.Box&&window.Box.isBox)if("undefined"!=typeof Box&&Box.isBox){if("android"===Box.os.name)if(Box.version_compare(Box.version,"6.6")>=0){var n={website_url:"https://waimai.baidu.com/mobile/waimai?qt=shopmenu&shop_id="+a,params:"https://waimai.baidu.com/mobile/waimai?qt=shopmenu&shop_id="+a,app_id:"2533830",package_name:"com.baidu.searchbox.takeout",method_name:"url_invoke",from:"web:life",log_url:"null",use_new_window:"0",log_header:"null"};Box.android.invokeApp("Bdbox_android_plugin","invokePlugin",JSON.stringify(n))}else Box.o2o("https://waimai.baidu.com/mobile/waimai?qt=shopmenu&shop_id="+a);else if("ios"===Box.os.name)if(Box.version_compare(Box.version,"6.7.0.1")>=0){var s="https://waimai.baidu.com/mobile/waimai?qt=shopmenu&shop_id="+a,n={url:s,plugin_id:"box.plugin.waimai"};Box.ios.invokeApp("invokePlug",{action:"open",params:encodeURIComponent(JSON.stringify(n)),minver:"6.1.0.0"},"")}else Box.o2o("https://waimai.baidu.com/mobile/waimai?qt=shopmenu&shop_id="+a)}else location.href="/mobile/waimai?qt=shopmenu&shop_id="+a;else""==channel?location.href='baidumap://map/component?comName=takeout&target=loadfromWebView&param={"entering_from":"web_view","page":"shopmenu","shop_id":"'+a+'"}':window.open(t)},_renderNoShop:function(){listener.trigger("activity.common.location","changeIcon");var e="";e+="<li class='no_res'>",e+='<p class="">附近没有参加活动的餐厅</p>',e+='<a href="//waimai.baidu.com/mobile/waimai" style="width: 92%;text-align: center;display: block;">返回百度外卖首页点餐</a>',e+="</li>",this.$dom.shoplist.html(e)},_renderShopLit:function(e,a){var t=this,i=a||this.data;if(!i.error_no&&i.result.shop_info.length){this.$dom.shoplist.empty();for(var n=0;n<i.result.shop_info.length;n++)i.result.shop_info[n].mapUrl='baidumap://map/component?comName=takeout&target=loadfromWebView&param={"entering_from":"web_view","target":"shopmenu","content":{"shop_id":"'+i.result.shop_info[n].shop_id+'","shop_name":"'+i.result.shop_info[n].shop_name+'","qid":"da_qid"}}';var s=list({data:i.result.shop_info,recall_info:"",city_info:i.result.data_notice,channel:urlOperator.getCurrentParam("channel")});this.$dom.shoplist.html(s),this.bindEvent()}else t._renderNoShop()},_getDataByAjax:function(e,a){var t=location.href;t=t+"&lng="+a.lng+"&lat="+a.lat+"&display=json",$.ajax({type:"get",dataType:"json",url:t,success:function(e){self._renderShopLit("",e)},error:function(){self._renderNoShop()}})}})});