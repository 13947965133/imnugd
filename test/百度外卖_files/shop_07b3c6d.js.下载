define("mwaimai:widget/shoplist/category/category.js",function(t,i,n){var e=t("mwaimai:widget/common/urlFactory/urlFactory.js");n.exports=Widget.extend({el:"#widget-shoplist-category",init:function(t){this.recall_info=t,this.initEvent()},initEvent:function(){var t=this;$(".category-wrapper li").on("click",function(){t.initJump(this)})},initJump:function(t){var i=$(t).attr("type"),n=e.getUrl("shoplist",{lat:this.recall_info.lat,lng:this.recall_info.lng,address:this.recall_info.address,categorytype:i});window.location.href=n}})});
;define("mwaimai:widget/shoplist/filter/filter.js",function(require,exports,module){var headsTpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<ul class="list-group">'),_.each(data,function(e,t){if(_template_fun_array.push("    "),e.name){if(_template_fun_array.push("    "),e.id=0==e.id?"":e.id,_template_fun_array.push('    <li class="fis-filter-item ',"undefined"==typeof(t==selectedIdx?"selected":"")?"":baidu.template._encodeHTML(t==selectedIdx?"selected":""),'" data-param="',"undefined"==typeof(nodeKey+"="+e.id)?"":baidu.template._encodeHTML(nodeKey+"="+e.id),'">    '),e.filterTitle){if(_template_fun_array.push('    <span class="list-ics">        '),"logistics"==e.id)var a="//s.waimai.baidu.com/static/webapp/logistics_s.png";else var a="//waimai.baidu.com/static/forwebapp/"+e.id+"_b.png";_template_fun_array.push("        "),a=customization.replaceGlobalResource(a),_template_fun_array.push('        <img src="',"undefined"==typeof a?"":baidu.template._encodeHTML(a),'">    </span>    ')}_template_fun_array.push("    <a>","undefined"==typeof e.name?"":baidu.template._encodeHTML(e.name),'</a>    <i class="',"undefined"==typeof(t==selectedIdx?"icon-checkmark":"")?"":baidu.template._encodeHTML(t==selectedIdx?"icon-checkmark":""),'"></i>    </li>    ')}_template_fun_array.push("")}),_template_fun_array.push("</ul>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],utils=require("mwaimai:static/utils.js"),DataHelper=require("mwaimai:static/utils/DataHelper.js"),Stat=require("mwaimai:static/utils/stat.js"),widget_data;module.exports=Widget.extend({el:"#widget-shoplist-filter",events:{'click [data-node="filtermenu"] li':"clickOnMenu",'click [data-node="filtercon"] li':"clickOnFilter"},channels:{"shoplist.mask hide":"hideFilter"},filter:{name:"福利",value:{all:{name:"全部餐厅",id:""}}},init:function(e){widget_data=e.cur;var t=this,a=[{name:"默认排序",showname:"排序",id:""},{name:"按销量由高到低",id:"month_sales"},{name:"送餐速度由快到慢",id:"dtime"}];if(e.conf={taste:{name:"口味",value:e.cur.classify},sortby:{name:"排序",value:a}},this.data=DataHelper(e),e.filters){var i=e.filters;$.each(i,function(e,a){var i=a;t.filter.value[i.type]={name:i.msg,filterTitle:i.msg,id:i.type}})}this.data.prop("conf.promotion",this.filter);var l=this.data.prop("cur.filter.promotion")||"all";this.$dom.promotion.data("idx",l)},_setActivityTitle:function(e){var t=this.filter.value[e].filterTitle,a=$('[data-node="promotion"]').find("p").find("span");a.html(t?t:"福利")},clickOnMenu:function(e){var t,a=$(e.currentTarget),i=a.attr("data-idx"),l=a.attr("data-node");return a.hasClass("selected")?(a.removeClass("selected"),a.find("i").removeClass("icon-arrow-up1"),a.find("i").addClass("icon-arrow-down1"),listener.trigger("shoplist.filter","hide"),void this.hideFilter()):(listener.trigger("shoplist.filter","show"),this.$dom.filtermenu.find("li").removeClass("selected"),this.$dom.filtermenu.find("i").removeClass(),this.$dom.filtermenu.find("i").addClass("icon-arrow-down1"),a.find("i").removeClass("icon-arrow-down1"),a.addClass("selected"),a.find("i").addClass("icon-arrow-up1"),t=headsTpl({data:this.data.conf[l].value,selectedIdx:i,nodeKey:l}),this.$dom.filtercon.html(t),void Stat.addStat("SAK",{da_trd:"waimai",da_src:"MwaimaiShopListPg.FilterBk.MenuBtn",da_act:"click"}))},clickOnFilter:function(e){Stat.addStat("SAK",{da_trd:"waimai",da_src:"MwaimaiShopListPg.FilterBk.filterBtn",da_act:"click"});var t=$(e.currentTarget),a=(window.location.href,t.attr("data-param")),i=a.split("="),l=utils.getParams(window.location.href);this.$dom.filtercon.find("li").removeClass("selected"),this.$dom.filtercon.find("i").removeClass("icon-checkmark"),t.addClass("selected"),t.find("i").addClass("icon-checkmark");var n=$("[data-node=filtermenu]").find("li").filter(".selected").attr("data-node");if(a&&i[0]){i[1]?l[i[0]]=i[1]:delete l[i[0]],"taste"==n&&delete l.promotion;var r=window.location.origin+window.location.pathname+this._getURL(l);window.location=r}},hideFilter:function(){this.$dom.filtercon.html(""),this.$dom.filtermenu.find("li").removeClass("selected"),this.$dom.filtermenu.find("i").removeClass(),this.$dom.filtermenu.find("i").addClass("icon-arrow-down1")},_getURL:function(e){var t=[];for(var a in e)e.hasOwnProperty(a)&&t.push([a,e[a]].join("="));return"?"+t.join("&")}})});
;define("mwaimai:widget/shoplist/list/customizeReplace.js",function(e,i,t){t.exports=Widget.extend({})});
;define("mwaimai:widget/shoplist/list/list.js",function(require,exports,module){var urlFactory=require("mwaimai:widget/common/urlFactory/urlFactory.js"),localstorage=require("mwaimai:static/utils/localstorage.js"),utils=require("mwaimai:static/utils.js"),urlnav=require("mwaimai:comp/urlnav/urlnav.js"),Stat=require("mwaimai:static/utils/stat.js"),welfareMap=require("mwaimai:static/utils/globalWelfare.js"),cityCookie=require("mwaimai:static/utils/CookieDataCenter.js"),SHOPLIST_AJAX="/mobile/waimai?qt=shoplist",popup=require("mwaimai:comp/popup/popup.js"),itemTpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){function getIconSrc(a,e){if("logistics"==a)var t="//s.waimai.baidu.com/static/webapp/logistics_s.png";else var t="//waimai.baidu.com/static/forwebapp/"+a+"_"+e+".png";try{"certification"==a&&city_info&&333==city_info.city_id&&(t="//waimai.baidu.com/static/forwebapp/certification_jinhua_"+e+".png")}catch(i){}return t=customization.replaceGlobalResource(t)}var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push(""),_template_fun_array.push("");for(var i=0,len=data.length;len>i;i++){var item=data[i];if(_template_fun_array.push(""),$(".data"+item.release_id).length<=0){_template_fun_array.push('<li class="shop-item-wrapper data',"undefined"==typeof item.release_id?"":baidu.template._encodeHTML(item.release_id),'" data-node="jumpShopMenu" data-shop_id="',"undefined"==typeof item.release_id?"":baidu.template._encodeHTML(item.release_id),'" data-store="',"undefined"==typeof item.is_store?"":baidu.template._encodeHTML(item.is_store),'"><div class="item-list"><div class="list-img">'),item.logo_url?_template_fun_array.push('<img class="lazy-load" src="',"undefined"==typeof transparent_img?"":baidu.template._encodeHTML(transparent_img),'" data-url="//map.baidu.com/maps/services/thumbnails?width=172&amp;height=126&amp;quality=60&amp;src=',"undefined"==typeof(item.logo_url||"")?"":baidu.template._encodeHTML(item.logo_url||""),'&amp;align=center%2Ccenter">'):_template_fun_array.push('<img class="default-img" src="',"undefined"==typeof transparent_img?"":baidu.template._encodeHTML(transparent_img),'" alt="" />'),_template_fun_array.push('</div><div class="list-wrapper"><h4 class="text-title">');var wlen=item.welfare_basic_info.length;_template_fun_array.push('<p class="shopname">',"undefined"==typeof(item.shop_name||"")?"":baidu.template._encodeHTML(item.shop_name||""),'</p><!--    show logos of basic warefare info like pay & invoice    image url rule : basic domin + type + _ + size    field: welfare_basic_info    --></h4><div class="shop-status">'),1==item.bussiness_status?_template_fun_array.push('<span class="status stop">休息中</span>'):2==item.bussiness_status?(_template_fun_array.push('<span class="status order">仅预订</span>'),item.start_time&&_template_fun_array.push('<span class="open">',"undefined"==typeof item.start_time?"":baidu.template._encodeHTML(item.start_time),"开始配送</span>"),_template_fun_array.push("")):3==item.bussiness_status?(_template_fun_array.push(""),0==item.saled_month||item.saled_month?_template_fun_array.push("                月售<span>","undefined"==typeof item.saled_month?"":baidu.template._encodeHTML(item.saled_month),"</span>份                "):_template_fun_array.push("                已售<span>","undefined"==typeof item.saled?"":baidu.template._encodeHTML(item.saled),"</span>份                "),_template_fun_array.push("")):4==item.bussiness_status?_template_fun_array.push('<span class="status stop">已打烊</span>'):5==item.bussiness_status&&(_template_fun_array.push('<span class="status reserve">需预定</span>'),item.advance_need_order_day&&_template_fun_array.push('<span class="open">需提前',"undefined"==typeof item.advance_need_order_day?"":baidu.template._encodeHTML(item.advance_need_order_day),"天预定</span>"),_template_fun_array.push("")),_template_fun_array.push('</div><div class="shop-msg"><span>起送费 ￥',"undefined"==typeof(Math.round(100*Number(item.takeout_price))/100)?"":baidu.template._encodeHTML(Math.round(100*Number(item.takeout_price))/100),"</span><span>配送费￥","undefined"==typeof(item.takeout_cost||"0")?"":baidu.template._encodeHTML(item.takeout_cost||"0"),"</span>                    "),0==item.advance_need_order_day&&_template_fun_array.push('<span class="delivery-time">',"undefined"==typeof item.delivery_time?"":baidu.template._encodeHTML(item.delivery_time),"分钟</span>                    "),_template_fun_array.push('</div><!--       show logos of discount warefare info like jian & mian       image url rule : basic domin + type + _ + size       filed: welfare_act_info    --></div><div class="activity-count"  data-node="toggleActivity">');var actLength=item.welfare_act_info.length;_template_fun_array.push("");for(var j=0;j<item.welfare_basic_info.length;j++){if(_template_fun_array.push(""),"invoice"===item.welfare_basic_info[j].type){actLength++;break}_template_fun_array.push("")}_template_fun_array.push(""),actLength>2&&_template_fun_array.push("","undefined"==typeof actLength?"":baidu.template._encodeHTML(actLength),'个活动<i class="icon-arrow-down1 toggle-activity" data-node="toggleArrow"></i>'),_template_fun_array.push("</div></div><!--       show details of warefare infos       filed: welfare_act_info --> ");var wcount=0;_template_fun_array.push(" ");var MAX_SHOW_LENGTH=2;if(_template_fun_array.push("<div class='warefare-details-card'>"),item.welfare_act_info.length>0){_template_fun_array.push("");var wlen=item.welfare_act_info.length;_template_fun_array.push("");for(var j=0;wlen>j;j++){_template_fun_array.push("            ");var imgUrl=getIconSrc(item.welfare_act_info[j].type,"s");if(_template_fun_array.push("                     "),"del"!=imgUrl&&(_template_fun_array.push("            <div class='card-warefare-list'>            <img class=\"welfare-logo-small\" src=","undefined"==typeof imgUrl?"":baidu.template._encodeHTML(imgUrl),' alt="">            '),item.welfare_act_info[j].msg&&_template_fun_array.push("            <span class='msg'>            ","undefined"==typeof item.welfare_act_info[j].msg?"":baidu.template._encodeHTML(item.welfare_act_info[j].msg),"            </span>            "),_template_fun_array.push("            </div>            ")),_template_fun_array.push("            "),wcount++,wcount==MAX_SHOW_LENGTH)break;_template_fun_array.push("       ")}_template_fun_array.push("    ")}if(_template_fun_array.push("        "),MAX_SHOW_LENGTH>wcount){_template_fun_array.push("        ");for(var j=0;j<item.welfare_basic_info.length;j++){if(_template_fun_array.push("        "),"invoice"===item.welfare_basic_info[j].type){_template_fun_array.push("        ");var imgUrl=getIconSrc(item.welfare_basic_info[j].type,"s");_template_fun_array.push("                    "),"del"!=imgUrl&&(_template_fun_array.push("<div class='card-warefare-list'>            <img class=\"welfare-logo-small\" src=","undefined"==typeof imgUrl?"":baidu.template._encodeHTML(imgUrl),' alt="">            '),item.welfare_basic_info[j].msg&&_template_fun_array.push("            <span class='msg'>            ","undefined"==typeof item.welfare_basic_info[j].msg?"":baidu.template._encodeHTML(item.welfare_basic_info[j].msg),"            </span>            "),_template_fun_array.push("            </div>        ")),_template_fun_array.push("        ")}_template_fun_array.push("        ")}_template_fun_array.push("    ")}if(_template_fun_array.push("</div><div class='warefare-details-card-more' data-node=\"warefareDetailsCardMore\">"),wcount==MAX_SHOW_LENGTH){if(_template_fun_array.push(""),item.welfare_act_info.length>=MAX_SHOW_LENGTH){for(_template_fun_array.push(""),j=MAX_SHOW_LENGTH;j<item.welfare_act_info.length;j++){_template_fun_array.push("");var imgUrl=getIconSrc(item.welfare_act_info[j].type,"s");_template_fun_array.push("                    "),"del"!=imgUrl&&(_template_fun_array.push("<div class='card-warefare-list'>            <img class=\"welfare-logo-small\" src=","undefined"==typeof imgUrl?"":baidu.template._encodeHTML(imgUrl),' alt="">            '),item.welfare_act_info[j].msg&&_template_fun_array.push("            <span class='msg'>            ","undefined"==typeof item.welfare_act_info[j].msg?"":baidu.template._encodeHTML(item.welfare_act_info[j].msg),"            </span>            "),_template_fun_array.push("            </div>        ")),_template_fun_array.push("")}_template_fun_array.push("");for(var j=0;j<item.welfare_basic_info.length;j++){if(_template_fun_array.push("        "),"invoice"===item.welfare_basic_info[j].type){_template_fun_array.push("        ");var imgUrl=getIconSrc(item.welfare_basic_info[j].type,"s");_template_fun_array.push("                    "),"del"!=imgUrl&&(_template_fun_array.push("<div class='card-warefare-list'>            <img class=\"welfare-logo-small\" src=","undefined"==typeof imgUrl?"":baidu.template._encodeHTML(imgUrl),' alt="">            '),item.welfare_basic_info[j].msg&&_template_fun_array.push("            <span class='msg'>            ","undefined"==typeof item.welfare_basic_info[j].msg?"":baidu.template._encodeHTML(item.welfare_basic_info[j].msg),"            </span>            "),_template_fun_array.push("            </div>        ")),_template_fun_array.push("        ")}_template_fun_array.push("        ")}_template_fun_array.push("")}_template_fun_array.push("")}_template_fun_array.push("</div></li>")}_template_fun_array.push("")}_template_fun_array.push(""),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],emptyTpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push("<li class='no_res'><p class=\"\">附近没有外卖餐厅，努力覆盖中</p></li>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],cookie=require("mwaimai:static/utils/Cookie.js"),DELAY=1e4,RECALLINFO="",EXTRA_HEIGHT=82,CACHE_HEIGHT=200;module.exports=Widget.extend({bannerIndex:0,el:"#widget-shoplist-list",events:{"click .warefare-details-card":"toggleActivity","click .warefare-details-card-more":"toggleActivity",'click [data-node="shoplist"] li a':"showDetail",'click [data-node="gotosearch"]':"gotoSearch",'click [data-node="mask"]':"maskOnClc",'click [data-node="jumpShopMenu"]':"jumpShopMenu"},channels:{"shoplist.filter show":"onFilterShow","shoplist.filter hide":"onFilterHide","common.nav click_title":"gotoAddr"},init:function(a){this.data=a,this.filter=a.filter;var e=this.checkLocation();e&&(RECALLINFO=a.recall_info,this.opt={count:20,page:1,curIndex:0,num:10},this.renderList(a),cityCookie.setUrl(),this.bindScrollEvent())},bindScrollEvent:function(){var a=this;$(window).on("scroll",function(){var e=$(window).scrollTop(),t=a.$el.height()+EXTRA_HEIGHT-document.body.clientHeight,i=t-e;CACHE_HEIGHT>i&&(a.lockLoadMore||a.opt.num<a.data.total&&a.showMore())})},checkLocation:function(){var a={name:this.data.recall_info.address,lat:this.data.recall_info.lat,lng:this.data.recall_info.lng};localstorage.addData("addrInfo",JSON.stringify(a));var e=(utils.getParam("address")||a.name,utils.getParam("lng")||a.lng),t=utils.getParam("lat")||a.lat;return t&&e?!0:(popup.open("位置信息缺失，3秒后前往定位页面。"),setTimeout(function(){var a=urlFactory.getUrl("confirmcity");window.location.href=a},3e3),!1)},onFilterShow:function(){this.$dom.mask.show()},onFilterHide:function(){this.$dom.mask.hide()},maskOnClc:function(){this.$dom.mask.hide(),listener.trigger("shoplist.mask","hide")},renderList:function(a){if(!a||!a.shop_info||!a.shop_info.length)return void this.renderNoRes();var e=this.opt.curIndex,t=this.opt.num,i=e+t,r="//static.waimai.baidu.com/static/mwaimai/images/transparent_3254726.gif",n=a.shop_info.slice(e,i);if(!a.is_show_welfare)for(var s=0;s<n.length;s++)n[s].welfare_act_info=[];this.$dom.shoplist.append(itemTpl({data:n,transparent_img:r,recall_info:RECALLINFO,urlnav:urlnav,city_info:a.data_notice})),this.opt.curIndex=i,this.$el.find("img.lazy-load").lazyload({data_attribute:"url"})},renderNoRes:function(){this.$dom.shoplist.html(emptyTpl())},showMore:function(){var a=this.data.shop_info.length;this.opt.curIndex>=a&&this.loadMore(),this.opt.curIndex<a&&this.renderList(this.data),Stat.addStat("SAK",{da_trd:"waimai",da_src:"MwaimaiShopListPg.ListBk.ShowMoreBtn",da_act:"click"})},showDetail:function(a){Stat.addStat("SAK",{da_trd:"waimai",da_src:"MwaimaiShopListPg.ListBk.ShowDetailBtn",da_act:"click"});var e=$(a.currentTarget);e.hasClass("no_res")||(setTimeout(function(){e.css({background:"#f0f3fc"})},1e3),$(a.currentTarget).attr("data-url")&&(window.location.href=$(a.currentTarget).attr("data-url")))},gotoSearch:function(a){Stat.addStat("SAK",{da_trd:"waimai",da_src:"MwaimaiShopListPg.SearchBk.SearchBtn",da_act:"click"}),window.location.href=$(a.currentTarget).attr("data-url")},gotoAddr:function(){var a=cityCookie.getCity(),e=urlFactory.getUrl("confirmcity"),t=urlFactory.getUrl("confirmaddr");window.location.href=a.code&&a.city?t:e},loadMore:function(){var a=this;a.lockLoadMore=!0,$.ajax({url:location.href,data:{page:++this.opt.page,count:this.opt.count,display:"json"},beforeSend:function(){popup.close(),$("#page-loader").show()},complete:function(){a.lockLoadMore=!1},dataType:"json",success:function(e){$("#page-loader").hide(),0==e.error_no&&(e.result&&e.result.shop_info&&e.result.shop_info.length?(a.data.shop_info=a.data.shop_info.concat(e.result.shop_info),a.data.data_notice=e.result.data_notice):"none"===$("#page-loader").css("display")&&popup.open("没有更多了～"))},error:function(){popup.open("网络错误，请重试！"),a.lockLoadMore=!1}})},jumpShopMenu:function(a){a.stopImmediatePropagation();var e,t=$(a.currentTarget),i=t.attr("data-shop_id"),r=Number(t.data("store")),n={shop_id:i,lat:RECALLINFO.lat,lng:RECALLINFO.lng,address:RECALLINFO.address,is_attr:1};r&&(n.page_size=200),e=r?urlFactory.getUrl("shopview",n):urlFactory.getUrl("shopmenu",n);var s=utils.getParam("third_party")||cookie.get("third_party")||"";s&&(e+="&third_party="+s),window.location.href=e},toggleActivity:function(a){a.stopPropagation(),a.stopImmediatePropagation();var e=$(a.currentTarget),t=e.parent().find(".toggle-activity"),i=e.parent().find(".warefare-details-card-more");t.hasClass("icon-arrow-down1")?(t.removeClass("icon-arrow-down1"),t.addClass("icon-arrow-up1"),i.show()):(t.removeClass("icon-arrow-up1"),t.addClass("icon-arrow-down1"),i.hide())}})});
;define("mwaimai:widget/shoplist/newtip/newtip.js",function(t,i,o){var e=(t("mwaimai:static/utils/localstorage.js"),t("mwaimai:static/platformInvoke/invoke.js")),a=t("mwaimai:static/utils.js");o.exports=Widget.extend({el:"#widget-shoplist-newtip",events:{'tap [data-node="tip-block-btn"]':"jumpToShopList",'tap [data-node="close-button"]':"closeTip"},init:function(t){this.filter=t.filter,e.setEvents();var i=a.getParams(),o=i.mask;o&&e.showMask()},closeTip:function(){$(".bottom-jump").hide(),$(".bottom-jump-content").hide()},jumpToShopList:function(){var t=a.getParams(),i=window.navigator.userAgent,o=/micromessenger/.test(i.toLowerCase())?!0:!1,n=t.mask,s=window.location.href,m=a.getParam("third_party")||cookie.get("third_party")||"";return"nuomijingang"==m&&o?void(location.href="https://d.nuomi.com"):void(o?n?e.showMask():(s+="&mask=1",window.location.href=e.getUniversalLink(s,"home")):e.webappJumpTo("home"))}})});
;define("mwaimai:widget/shoplist/search/search.js",function(require,exports,module){var urlFactory=require("mwaimai:widget/common/urlFactory/urlFactory.js"),Eraser=require("mwaimai:widget/common/ui/eraser/eraser.js"),localstorage=require("mwaimai:static/utils/localstorage.js"),popup=require("mwaimai:comp/popup/popup.js"),utils=require("mwaimai:static/utils.js"),urlnav=require("mwaimai:comp/urlnav/urlnav.js"),POI_SEARCH_AJAX="/waimai?qt=poisearch&ie=utf-8&sug=0&tn=B_NORMAL_MAP&oue=1&res=1&c=131&wd=",searchResTpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){function getIconSrc(e,a){if("logistics"==e)var t="//s.waimai.baidu.com/static/webapp/logistics_s.png";else var t="//waimai.baidu.com/static/forwebapp/"+e+"_"+a+".png";try{"certification"==e&&city_info&&333==city_info.city_id&&(t="//waimai.baidu.com/static/forwebapp/certification_jinhua_"+a+".png")}catch(r){}return t=customization.replaceGlobalResource(t)}var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push(""),_template_fun_array.push("");for(var i=0,len=data.length;len>i;i++){var item=data[i];if(_template_fun_array.push(""),$(".data"+item.release_id).length<=0){_template_fun_array.push('<li class="shop-item-wrapper data',"undefined"==typeof item.release_id?"":baidu.template._encodeHTML(item.release_id),'" data-node="jumpShopMenu" data-shop_id="',"undefined"==typeof item.release_id?"":baidu.template._encodeHTML(item.release_id),'" data-store="',"undefined"==typeof item.is_store?"":baidu.template._encodeHTML(item.is_store),'"><div class="item-list"><div class="list-img">'),item.logo_url?_template_fun_array.push('<img class="lazy-load" src="',"undefined"==typeof transparent_img?"":baidu.template._encodeHTML(transparent_img),'" data-url="//map.baidu.com/maps/services/thumbnails?width=172&amp;height=126&amp;quality=60&amp;src=',"undefined"==typeof(item.logo_url||"")?"":baidu.template._encodeHTML(item.logo_url||""),'&amp;align=center%2Ccenter">'):_template_fun_array.push('<img class="default-img" src="',"undefined"==typeof transparent_img?"":baidu.template._encodeHTML(transparent_img),'" alt="" />'),_template_fun_array.push('</div><div class="list-wrapper"><h4 class="text-title">');var wlen=item.welfare_basic_info.length;_template_fun_array.push('<p class="shopname">',"undefined"==typeof(item.shop_name||"")?"":baidu.template._encodeHTML(item.shop_name||""),'</p><!--    show logos of basic warefare info like pay & invoice    image url rule : basic domin + type + _ + size    field: welfare_basic_info    --></h4><div class="shop-status">'),1==item.bussiness_status?_template_fun_array.push('<span class="status stop">休息中</span>'):2==item.bussiness_status?(_template_fun_array.push('<span class="status order">仅预订</span>'),item.start_time&&_template_fun_array.push('<span class="open">',"undefined"==typeof item.start_time?"":baidu.template._encodeHTML(item.start_time),"开始配送</span>"),_template_fun_array.push("")):3==item.bussiness_status?(_template_fun_array.push(""),0==item.saled_month||item.saled_month?_template_fun_array.push("                月售<span>","undefined"==typeof item.saled_month?"":baidu.template._encodeHTML(item.saled_month),"</span>份                "):_template_fun_array.push("                已售<span>","undefined"==typeof item.saled?"":baidu.template._encodeHTML(item.saled),"</span>份                "),_template_fun_array.push("")):4==item.bussiness_status?_template_fun_array.push('<span class="status stop">已打烊</span>'):5==item.bussiness_status&&(_template_fun_array.push('<span class="status reserve">需预定</span>'),item.advance_need_order_day&&_template_fun_array.push('<span class="open">需提前',"undefined"==typeof item.advance_need_order_day?"":baidu.template._encodeHTML(item.advance_need_order_day),"天预定</span>"),_template_fun_array.push("")),_template_fun_array.push('</div><div class="shop-msg"><span>起送费 ￥',"undefined"==typeof(Math.round(100*Number(item.takeout_price))/100)?"":baidu.template._encodeHTML(Math.round(100*Number(item.takeout_price))/100),"</span><span>配送费￥","undefined"==typeof(item.takeout_cost||"0")?"":baidu.template._encodeHTML(item.takeout_cost||"0"),"</span>                    "),0==item.advance_need_order_day&&_template_fun_array.push('<span class="delivery-time">',"undefined"==typeof item.delivery_time?"":baidu.template._encodeHTML(item.delivery_time),"分钟</span>                    "),_template_fun_array.push('</div><!--       show logos of discount warefare info like jian & mian       image url rule : basic domin + type + _ + size       filed: welfare_act_info    --></div><div class="activity-count"  data-node="toggleActivity">');var actLength=item.welfare_act_info.length;_template_fun_array.push("");for(var j=0;j<item.welfare_basic_info.length;j++){if(_template_fun_array.push(""),"invoice"===item.welfare_basic_info[j].type){actLength++;break}_template_fun_array.push("")}_template_fun_array.push(""),actLength>2&&_template_fun_array.push("","undefined"==typeof actLength?"":baidu.template._encodeHTML(actLength),'个活动<i class="icon-arrow-down1 toggle-activity" data-node="toggleArrow"></i>'),_template_fun_array.push("</div></div><!--       show details of warefare infos       filed: welfare_act_info --> ");var wcount=0;_template_fun_array.push(" ");var MAX_SHOW_LENGTH=2;if(_template_fun_array.push("<div class='warefare-details-card'>"),item.welfare_act_info.length>0){_template_fun_array.push("");var wlen=item.welfare_act_info.length;_template_fun_array.push("");for(var j=0;wlen>j;j++){_template_fun_array.push("            ");var imgUrl=getIconSrc(item.welfare_act_info[j].type,"s");if(_template_fun_array.push("                     "),"del"!=imgUrl&&(_template_fun_array.push("            <div class='card-warefare-list'>            <img class=\"welfare-logo-small\" src=","undefined"==typeof imgUrl?"":baidu.template._encodeHTML(imgUrl),' alt="">            '),item.welfare_act_info[j].msg&&_template_fun_array.push("            <span class='msg'>            ","undefined"==typeof item.welfare_act_info[j].msg?"":baidu.template._encodeHTML(item.welfare_act_info[j].msg),"            </span>            "),_template_fun_array.push("            </div>            ")),_template_fun_array.push("            "),wcount++,wcount==MAX_SHOW_LENGTH)break;_template_fun_array.push("       ")}_template_fun_array.push("    ")}if(_template_fun_array.push("        "),MAX_SHOW_LENGTH>wcount){_template_fun_array.push("        ");for(var j=0;j<item.welfare_basic_info.length;j++){if(_template_fun_array.push("        "),"invoice"===item.welfare_basic_info[j].type){_template_fun_array.push("        ");var imgUrl=getIconSrc(item.welfare_basic_info[j].type,"s");_template_fun_array.push("                    "),"del"!=imgUrl&&(_template_fun_array.push("<div class='card-warefare-list'>            <img class=\"welfare-logo-small\" src=","undefined"==typeof imgUrl?"":baidu.template._encodeHTML(imgUrl),' alt="">            '),item.welfare_basic_info[j].msg&&_template_fun_array.push("            <span class='msg'>            ","undefined"==typeof item.welfare_basic_info[j].msg?"":baidu.template._encodeHTML(item.welfare_basic_info[j].msg),"            </span>            "),_template_fun_array.push("            </div>        ")),_template_fun_array.push("        ")}_template_fun_array.push("        ")}_template_fun_array.push("    ")}if(_template_fun_array.push("</div><div class='warefare-details-card-more' data-node=\"warefareDetailsCardMore\">"),wcount==MAX_SHOW_LENGTH){if(_template_fun_array.push(""),item.welfare_act_info.length>=MAX_SHOW_LENGTH){for(_template_fun_array.push(""),j=MAX_SHOW_LENGTH;j<item.welfare_act_info.length;j++){_template_fun_array.push("");var imgUrl=getIconSrc(item.welfare_act_info[j].type,"s");_template_fun_array.push("                    "),"del"!=imgUrl&&(_template_fun_array.push("<div class='card-warefare-list'>            <img class=\"welfare-logo-small\" src=","undefined"==typeof imgUrl?"":baidu.template._encodeHTML(imgUrl),' alt="">            '),item.welfare_act_info[j].msg&&_template_fun_array.push("            <span class='msg'>            ","undefined"==typeof item.welfare_act_info[j].msg?"":baidu.template._encodeHTML(item.welfare_act_info[j].msg),"            </span>            "),_template_fun_array.push("            </div>        ")),_template_fun_array.push("")}_template_fun_array.push("");for(var j=0;j<item.welfare_basic_info.length;j++){if(_template_fun_array.push("        "),"invoice"===item.welfare_basic_info[j].type){_template_fun_array.push("        ");var imgUrl=getIconSrc(item.welfare_basic_info[j].type,"s");_template_fun_array.push("                    "),"del"!=imgUrl&&(_template_fun_array.push("<div class='card-warefare-list'>            <img class=\"welfare-logo-small\" src=","undefined"==typeof imgUrl?"":baidu.template._encodeHTML(imgUrl),' alt="">            '),item.welfare_basic_info[j].msg&&_template_fun_array.push("            <span class='msg'>            ","undefined"==typeof item.welfare_basic_info[j].msg?"":baidu.template._encodeHTML(item.welfare_basic_info[j].msg),"            </span>            "),_template_fun_array.push("            </div>        ")),_template_fun_array.push("        ")}_template_fun_array.push("        ")}_template_fun_array.push("")}_template_fun_array.push("")}_template_fun_array.push("</div></li>")}_template_fun_array.push("")}_template_fun_array.push(""),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],emptyTpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push("<li class='no_res'><a><p>抱歉，没有找到“","undefined"==typeof wd?"":baidu.template._encodeHTML(wd),"”相关的餐厅</p></a></li>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],Stat=require("mwaimai:static/utils/stat.js"),welfareMap=require("mwaimai:static/utils/globalWelfare.js"),RECALLINFO="";module.exports=Widget.extend({el:"#shoplist-widget-search",events:{"click .warefare-details-card":"toggleActivity",'click [data-node="showWalfareDetail"]':"showWalfareDetail","click [data-node=searchbtn]":"select","click li a[data-url]":"urlJump",'click [data-node="jumpShopMenu"]':"jumpShopMenu"},init:function(e){var a=JSON.parse(localstorage.getData("addrInfo")),t=a.name,r=a.lng,i=a.lat;RECALLINFO={lat:i,lng:r,address:t},e=e||{};var _=e.filter&&e.filter.wd;if(_){if($("#se-input-wd").val(_),!e.is_show_welfare)for(var s=0;s<e.shop_info.length;s++)e.shop_info[s].welfare_act_info=[];this.renderRes(e.shop_info,e.data_notice)}Stat.addStat("SAK",{da_src:"MwaimaiShopSearchPg",da_act:"show",da_trd:"waimai"}),Eraser.attach(this.$dom.searchIn)},select:function(){Stat.addStat("SAK",{da_src:"MwaimaiShopSearchPg.SearchBk.SearchBtn",da_act:"click",da_trd:"waimai"});var e=this,a=e.$el.find("#se-input-wd"),t=a.val();return t?void this.doSearch(t):(popup.open("请填写要找的餐厅名称！"),void a.focus())},doSearch:function(e){var a=this,t="/mobile/waimai?qt=shopsearch";$.ajax({url:t,type:"GET",dataType:"json",data:{address:RECALLINFO.address,lat:RECALLINFO.lat,lng:RECALLINFO.lng,wd:e,display:"json"},beforeSend:function(){a.$el.find("#se-input-wd").blur(),walle.appResource.appLoader.show()},success:function(e){var t=e.result.shop_info,r=e.result.data_notice;if(!e.result.is_show_welfare)for(var i=0;i<t.length;i++)t[i].welfare_act_info=[];a.renderRes(t,r)},error:function(){popup.open("网络打酱油去了，请重新搜索试试！")},complete:function(){walle.appResource.appLoader.hide()}})},renderRes:function(e,a){return e&&e.length?(this.$dom.shoplist.html(searchResTpl({data:e,recall_info:RECALLINFO,city_info:a})),void this.$el.find("img.lazy-load").lazyload({data_attribute:"url"})):void this.renderNoRes()},renderNoRes:function(){var e=$("#se-input-wd").val();e&&this.$dom.shoplist.html(emptyTpl({wd:e}))},urlJump:function(e){Stat.addStat("SAK",{da_src:"MwaimaiShopSearchPg.ShopListBk.CommitBtn",da_act:"click",da_trd:"waimai"});var a=$(e.currentTarget).attr("data-url");window.location.href=a},toggleActivity:function(e){e.stopPropagation(),e.stopImmediatePropagation();var a=$(e.currentTarget),t=a.prev().find(".toggle-activity"),r=a.next();t.hasClass("icon-arrow-down1")?(t.removeClass("icon-arrow-down1"),t.addClass("icon-arrow-up1"),r.show()):(t.removeClass("icon-arrow-up1"),t.addClass("icon-arrow-down1"),r.hide())},jumpShopMenu:function(e){e.stopImmediatePropagation();var a,t=$(e.currentTarget),r=t.attr("data-shop_id"),i=Number(t.data("store")),_={shop_id:r,lat:RECALLINFO.lat,lng:RECALLINFO.lng,address:RECALLINFO.address,is_attr:1};i&&(_.page_size=200),a=i?urlFactory.getUrl("shopview",_):urlFactory.getUrl("shopmenu",_),window.location.href=a}})});
;define("mwaimai:widget/shoplist/slider/slider.js",function(i,e,s){s.exports=Widget.extend({el:"#widget-shoplist-slider",init:function(){this.slider()},slider:function(){var i=[];if($("#position li").length>1)var i=$("#position li");new Swipe($("#widget-shoplist-slider")[0],{auto:2e3,continuous:!0,disableScroll:!1,stopPropagation:!1,callback:function(e){var s=i.length;for(e>=s&&(e%=2);s--;)i[s].className=" ";i[e].className="cur"}})}})});
;define("mwaimai:widget/shoplist/tip/tip.js",function(i,t,o){var a=i("mwaimai:static/utils/localstorage.js");o.exports=Widget.extend({el:"#widget-shoplist-tip",events:{"tap .tip-close":"_tipClose","tap .tip-btn":"_jumpToDownload"},init:function(){var i=this;i._checkTip()},_checkTip:function(){var i=this,t=a.getData("tipshow");t||(i.$el.show(),a.addData("tipshow",1))},_tipClose:function(){var i=this;i.$el.hide()},_jumpToDownload:function(){window.location="/mobile/waimai?qt=displaytpl"}})});
;define("mwaimai:widget/shopdetail/basicinfo/basicinfo.js",function(o,e,a){var i=o("mwaimai:comp/popup/popup.js"),t="/mobile/waimai?qt=addfavorite",s="/mobile/waimai?qt=delfavorite",r=o("mwaimai:widget/common/urlFactory/urlFactory.js"),n="https://wappass.baidu.com/passport/?authsite=1&sms=1";a.exports=Widget.extend({el:"#shopdetail-widget-basicinfo",events:{'click [data-node="favorite"]':"doFavorite"},init:function(o){this.shopId=o.release_id},doFavorite:function(){var o=this,e=o.$dom.favorite;e.hasClass("select")?o.delFavorite():o.addFavorite()},addFavorite:function(){function o(o){var a=e.$dom.favorite;if(0==o.error_no)i.open("收藏成功"),a.addClass("select");else if(1102==o.error_no){var t=r.getUrl("shopdetail"),s=n+"&u="+encodeURIComponent(t);window.location.href=s}else i.open("收藏失败")}var e=this;$.ajax({url:t,dataType:"json",data:{shop_id:e.shopId,display:"json"},success:o,error:function(){i.open("收藏失败")}})},delFavorite:function(){function o(o){var a=e.$dom.favorite;0==o.error_no?(i.open("取消收藏成功"),a.removeClass("select")):i.open("取消收藏失败")}var e=this;$.ajax({url:s,dataType:"json",data:{shop_id:e.shopId},success:o,error:function(){i.open("取消收藏失败")}})}})});
;define("mwaimai:widget/shopdetail/welfare/welfare.js",function(e,a,i){{var t=e("mwaimai:static/utils.js"),n=e("mwaimai:static/platformInvoke/invoke.js");e("mwaimai:static/utils/globalWelfare.js")}i.exports=Widget.extend({el:"#shopdetail-widget-welfare",events:{},init:function(e){this._changeBackground();var a=e.welfare_act_info,i=e.welfare_basic_info,t=e.welfare_act_info_h5;this.type=e.type,a&&a.length?this.renderWelfareAct(a):this.$el.find('[data-node="welfare-act-list-group"]').remove(),t&&t.length&&this.renderWelfareActH5(t),i&&i.length?this.renderWelfareBasic(i,e.city_id):this.$el.find('[data-node="welfare-basic-list-group"]').remove(),this.$el.css("display","block")},_changeBackground:function(){$("#wrapper").css("background","#ecedf1!important")},renderWelfareAct:function(e){var a=this;e.length>0&&(a.$el.find('[data-node="welfare-act-list-group"]').append('<div class="welfare-act-list-title">APP专享优惠<span data-node="jumpToApp">立享优惠 ></span></div>'),$.each(e,function(e,i){var t=a._createItem(i);a.$el.find('[data-node="welfare-act-list-group"]').append(t)}),a.$el.delegate('[data-node="jumpToApp"]',"click",a._jumpToApp))},renderWelfareActH5:function(e){var a=this;$.each(e,function(e,i){var t=a._createItem(i);a.$el.find('[data-node="welfare-h5-list-group"]').append(t)})},renderWelfareBasic:function(e,a){var i=this;$.each(e,function(e,t){var n=i._createItem(t,a);i.$el.find('[data-node="welfare-basic-list-group"]').append(n)})},_createItem:function(e,a){var i=$('<div class="walfare-item"></div>'),t=$("<img class='walfare-logo'></img>"),n=e.type;if("logistics"==n)var r="//s.waimai.baidu.com/static/webapp/logistics_s.png";else var r="//waimai.baidu.com/static/forwebapp/"+n+"_b.png";return"certification"==n&&333==a&&(r="//waimai.baidu.com/static/forwebapp/certification_jinhua_b.png"),r=customization.replaceGlobalResource(r),"del"==r?"":(t.attr({src:r}),i.append(t),i.append("<span class='welfare-msg'>"+e.msg+"</span>"),i)},_jumpToApp:function(){var e=t.getParams(),a=window.navigator.userAgent,i=/micromessenger/.test(a.toLowerCase())?!0:!1,r=window.location.href;i?-1!=r.indexOf("shopmenu")?window.location.href=n.getUniversalLink(r,"shopmenu"):-1!=r.indexOf("shopview")&&(window.location.href=n.getUniversalLink(r,"market")):n.webappJumpTo("shopdetail",{shopId:e.shop_id})}})});
;define("mwaimai:widget/shopmenu/annouce/annouce.js",function(require,exports,module){var Dialog=require("mwaimai:widget/brand/common/dialog/dialog.js"),readTpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="inner">   <header>       <h2>下单必读</h2>       <span class="close iconfont icon-dialog-close"></span>   </header>   <section class="content">    <p>      ',"undefined"==typeof data.status_text?"":baidu.template._encodeHTML(data.status_text),"    </p>    <p>","undefined"==typeof data.shop_announcement?"":data.shop_announcement,"</p>   </section>    <footer>    </footer></div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],DIALOGMAP={README:[readTpl,"book-read"]};module.exports=Widget.extend({el:"#market-menu",events:{"tap .annouce":"showReadDialog"},init:function(e){this.data=e,self.dialog=new Dialog({el:".read-dialog"}),console.log(self.dialog)},showReadDialog:function(){console.log("....."),self.dialog.show(DIALOGMAP.README,this.data)}})});
;define("mwaimai:widget/shopmenu/requireDishHint/requireDishHint.js",function(r,e,a){var t=r("mwaimai:static/utils/CartDataCenter.js"),i=null,n=null,_=null,o=function(r){var e=t.getCartData(),a=e.items,o=r.takeout_menu;i||g(o);var l=c(a),f=d(a,l),v=u(l,f);if(v)for(var s=(n[v],0);s<_.length;s++){var y=_[s];if(y.categoryId==v)return y.index=s,y}return null},u=function(r,e){for(var a in r)if(!e[a])return a;return null},d=function(r){for(var e={},a=0;a<r.length;a++){var t=r[a].itemId;t.indexOf("_")>-1&&(t=t.split("_")[0]);var n=i[t];if(n){var _=n.__category_id_Map;for(var o in _)e[o]=!0}}return e},c=function(r){for(var e={},a=0;a<r.length;a++){var t=r[a].itemId;t.indexOf("_")>-1&&(t=t.split("_")[0]);var n=i[t];n&&n.require_category_id&&"0"!=n.require_category_id&&(e[n.require_category_id]=!0)}return e},g=function(r){i={},n={},_=[];for(var e=0;e<r.length;e++){var a=r[e].data;n[r[e].category_id]=r[e].catalog,_.push({categoryId:r[e].category_id,catalogName:r[e].catalog});for(var t=0;t<a.length;t++){var o=a[t];if(o.__category_id_Map||(o.__category_id_Map={},o.__category_id_Map[o.category_id]=!0),i[o.item_id]){var u=i[o.item_id];u.__category_id_Map[o.category_id]=!0}else i[o.item_id]=o}}return i};a.exports={hasUnchosedRequiredDish:o}});
;define("mwaimai:widget/shopmenu/requireDishHint/requireHint.js",function(require,exports,module){var hintDialog=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="widget-shopmenu-require-dish-mask"><div class="widget-shopmenu-require-dish"><div class="widget-shopmenu-require-dish-content">您还有<span>',"undefined"==typeof catalogName?"":baidu.template._encodeHTML(catalogName),'</span>未选择，请选择后再下单</div><div class="widget-shopmenu-require-dish-sure">确定</div></div></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],sureClickHandler=null,showHint=function(e,i,n){var a=$(hintDialog(i));e.append(a),bindEvent(a,n)},bindEvent=function(e,i){var n=e.find(".widget-shopmenu-require-dish");n.on("click",function(e){e.stopPropagation()}),e.on("click",function(i){i.stopPropagation(),dismiss(e)}),n.find(".widget-shopmenu-require-dish-sure").on("click",function(n){n.stopPropagation(),dismiss(e),i&&i()})},dismiss=function(e){e.remove()};module.exports={showHint:showHint}});
;define("mwaimai:widget/shopmenu/cart/cart.js",function(require,exports,module){var cartlistTpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push("");var items=data.items;_template_fun_array.push("");var box_price=data.box_price;_template_fun_array.push("");for(var i=0,len=items.length,item;len>i&&(item=items[i]);i++){_template_fun_array.push("");var dataItem={itemId:item.itemId,itemName:item.itemName,itemPrice:item.itemPrice,packCount:item.packCount,packPrice:item.packPrice,minOrderNumber:item.minOrderNumber,leftNum:item.leftNum,sourceName:item.sourceName,dish_activity_obj:item.dish_activity_obj,feature_id:item.selectFeatures,itemId_feature:item.itemId_feature};_template_fun_array.push("");var dataStr=JSON.stringify(dataItem);_template_fun_array.push('    <li class="cl-item" data-item="',"undefined"==typeof dataStr?"":baidu.template._encodeHTML(dataStr),'">        <div class="cl-r1">',"undefined"==typeof item.itemName?"":baidu.template._encodeHTML(item.itemName),'</div>        <div class="cl-r3">￥',"undefined"==typeof fundFun.call(null,item.itemPrice*item.itemCount)?"":baidu.template._encodeHTML(fundFun.call(null,item.itemPrice*item.itemCount)),'</div>        <div class="cl-r2">            <div class="item-add">                <span class="btn -minus">                    <i class="icon-minus"></i>                </span>                <span class="item-count">',"undefined"==typeof item.itemCount?"":baidu.template._encodeHTML(item.itemCount),'</span>                <span class="btn -plus '),"baidu"==item.sourceName&&parseInt(item.leftNum)<=parseInt(item.itemCount)&&_template_fun_array.push(" disable"),_template_fun_array.push('">                    <i class="icon-plus"></i>                </span>            </div>            '),"baidu"==item.sourceName&&parseInt(item.leftNum)>0&&parseInt(item.leftNum)<=parseInt(item.itemCount)&&_template_fun_array.push("                        "),_template_fun_array.push('        </div>        <div class="cl-r4"></div>    </li>')}_template_fun_array.push(""),items.length>0&&box_price>0&&_template_fun_array.push('    <li class="cl-item">        <div class="cl-r1">餐盒费</div>        <div class="cl-r2 ">        </div>        <div class="cl-r3" data-node="box-price">                ￥',"undefined"==typeof box_price?"":baidu.template._encodeHTML(box_price),'        </div>        <div class="cl-r4"></div>    </li>'),_template_fun_array.push(""),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],utils=require("mwaimai:static/utils.js"),Stat=require("mwaimai:static/utils/stat.js"),positionManager=require("mwaimai:widget/common/location/positionManager/positionManager.js"),requireDishHint=require("mwaimai:widget/shopmenu/requireDishHint/requireDishHint.js"),requireHint=require("mwaimai:widget/shopmenu/requireDishHint/requireHint.js"),SHOPMENU_CATEGORY_JUMPTOINDEX="#shopmenu-category?jumpToIndex",IScroll=require("mwaimai:static/libs/iscroll.js"),popup=require("mwaimai:comp/popup/popup.js"),cookie=require("mwaimai:static/utils/Cookie.js"),cartListScroll,PAGE_HEAD_HEIGHT=102,PAGE_CART_BAR_HEIGHT=50;module.exports=Widget.extend({el:"#shopmenu-cart",events:{"tap #shopmenu-cart-list .item-add .-plus":"_doClickPlus","tap #shopmenu-cart-list .item-add .-minus":"_doClickMinus","click #shopmenu-cart-list .cl-r4":"_doClickDel","click #shopmenu-cart-bar .row-num":"_doClickCart","click #shopmenu-cart-bar .row-status":"_doCommitCart"},channels:{"cart.premium success":"_renderPremium","datacenter.cart ready":"_renderCart","datacenter.cart.shopmenu.cart.list getCartCenter":"_safeUpdateAsync"},init:function(t){var e=this;this.init=!1,this.$el.find("#shopmenu-cart-list").css("max-height",$(window).height()-(PAGE_HEAD_HEIGHT+PAGE_CART_BAR_HEIGHT)).on("touchmove",function(t){t.preventDefault()}),this.data=t,this.isStore=t.is_store,t&&t.status_text&&(PAGE_CART_BAR_HEIGHT=80),$(".global-mask").on("click",function(){e.hiddenCartList()}),cartListScroll=new IScroll("shopmenu-cart-list",{momentum:!1,hScroll:!1,hScrollbar:!1,vScrollbar:!1,vScroll:!0,lockDirection:!0,handleClick:!1}),t.is_show_welfare&&this._initAllzhe(t)},_initAllzhe:function(t){for(var e=0;e<t.welfare_act_info.length;e++)if("allzhe"==t.welfare_act_info[e].type){this.hasAllzhe=!0,this.$el.find(".row-cart").addClass("has-premium"),this.$el.find(".cart-premium").show(),this.$el.find(".cart-premium").html("该店全部商品享受"+t.welfare_act_info[e].discount_percent/10+"折优惠");break}},_renderActivePremium:function(t){t?this.$el.find(".row-cart").addClass("has-premium").find(".cart-premium").html("有"+t+"个商品可享受特价").show():this.$el.find(".row-cart").removeClass("has-premium").find(".cart-premium").empty().hide()},_renderPremium:function(t,e){{var i=(e.discounts.discount_list,e.prices);e.actNum}return this.hasAllzhe||0!==i.dishes_price?void 0:void this.$el.find(".row-cart").removeClass("has-premium").find(".cart-premium").empty().hide()},_renderCart:function(t,e){var i=this,a=0,r=0,s=0,n=this.$el.find("#shopmenu-cart-bar .row-status");this.$dom.cartStatus.removeClass("hide"),$.each(e.items,function(t,e){a+=parseInt(e.itemCount)*parseFloat(e.itemPrice),r+=parseInt(e.itemCount)}),a+=parseFloat(e.box_price),s=e.takeOutPrice-a,r?this.$el.find(".cart-count").html(r).css("visibility","visible"):this.$el.find(".cart-count").html("").css("visibility","hidden"),this.$el.find("#shopmenu-cart-list>ul").html(cartlistTpl({data:e,fundFun:i._calculateFund})),a=this._calculateFund(a),this.$el.find("#shopmenu-cart-bar .row-cart").find(".cart-price").html("共&nbsp;&#165;"+a+"&nbsp;元"),n.data("dishc",e.items.length),s>0?this.$el.find("#shopmenu-cart-bar .row-status").addClass("cb-disable").removeClass("local-disable").html("差&#165;"+this._calculateFund(s)+"起送"):Number(e.takeOutPrice)>0||e.items.length?n.removeClass("cb-disable").removeClass("local-disable").html("选好了"):n.addClass("local-disable").removeClass("cb-disable").html("差&#165;"+e.takeOutPrice+"起送"),cartListScroll.refresh(),this.init||(this.init=!0,this._renderInitPremium(e))},_renderInitPremium:function(t){for(var e=0,i=-1,a=0;a<t.items.length;a++)!t.items[a].dish_activity_obj||t.items[a].dish_activity_obj&&$.isEmptyObject(t.items[a].dish_activity_obj)||(i=a,premiumCount=parseInt(t.items[a].itemCount),parseInt(premiumCount)>parseInt(t.items[a].dish_activity_obj.dish_limit)&&(premiumCount=parseInt(t.items[a].dish_activity_obj.dish_limit)),e+=premiumCount);i>-1&&e>parseInt(t.items[i].dish_activity_obj.order_limit)&&(e=parseInt(t.items[i].dish_activity_obj.order_limit)),this.hasAllzhe||(e>0?($(".row-cart").addClass("has-premium"),$(".cart-premium").show(),$(".cart-premium").html("您有"+e+"份菜品可以享受优惠")):($(".row-cart").removeClass("has-premium"),$(".cart-premium").hide()))},_doClickPlus:function(t){Stat.addStat("SAK",{da_trd:"waimai",da_src:"MwaimaiShopMenuPg.CartBk.PlusBtn",da_act:"click"});var e=$(t.currentTarget);listener.trigger("shopmenu.cart.list","click_plus",e.parents("li[data-item]").data("item"))},_doClickMinus:function(t){Stat.addStat("SAK",{da_trd:"waimai",da_src:"MwaimaiShopMenuPg.CartBk.MinusBtn",da_act:"click"});var e=$(t.currentTarget),i=0;e.closest(".list-group").find(".item-count").each(function(){i+=Number($(this).text())}),1===i&&$(".global-mask").hide(),listener.trigger("shopmenu.cart.list","click_minus",e.parents("li[data-item]").data("item"))},_doClickDel:function(t){Stat.addStat("SAK",{da_trd:"waimai",da_src:"MwaimaiShopMenuPg.CartBk.DelBtn",da_act:"click"});var e=$(t.currentTarget);listener.trigger("shopmenu.cart.list","click_del",e.parents("li[data-item]").data("item"))},_doClickCart:function(){var t=$("#shopmenu-cart-list"),e=parseInt($(".cart-count").text());e&&(t.hasClass("visiHidden")?($(".global-mask").css("z-index","998").show(),t.removeClass("visiHidden"),t.addClass("up"),t.on("webkitAnimationEnd",function(){t.hasClass("up")&&t.removeClass("up")})):this.hiddenCartList())},hiddenCartList:function(){var t=$("#shopmenu-cart-list");t.addClass("down"),t.on("webkitAnimationEnd",function(){t.hasClass("down")&&(t.removeClass("down"),t.addClass("visiHidden"),$(".global-mask").css("z-index","22").hide())})},_doCommitCart:function(t){if(Stat.addStat("SAK",{da_trd:"waimai",da_src:"MwaimaiShopMenuPg.ListBk.CommitBtn",da_act:"click"}),this.isStore||this._checkRequiredDish()){var e=$(t.currentTarget);if(0==e.data("dishc")&&popup.open("您还没选择菜品！"),!e.hasClass("cb-disable")&&!e.hasClass("local-disable")){var i="",a=positionManager.getPosition();i="&address="+a.address+"&lat="+a.lat+"&lng="+a.lng;{$(this)}utils.checkLogin(function(){location.href=$(t.currentTarget).data("url")+i})}}},_checkRequiredDish:function(){var t=requireDishHint.hasUnchosedRequiredDish(this.data);return t?(requireHint.showHint(this.$el,t,function(){WidgetManager.communicate({url:SHOPMENU_CATEGORY_JUMPTOINDEX,data:[t.index]})}),!1):!0},_calculateFund:function(t){var e=/\d+\.\d+/,i=t;return e.test(t)&&(i=(Math.round(100*Number(t))/100).toFixed(2)),i},_safeUpdateAsync:function(t,e){var i=e.cartCenter,a=(new Date).getTime();this.premium_request_id=a,this._requestPremium(i,a)},_requestPremium:function(t,e){var i=this,a=t.updatePremiumAsync;a(function(a){if(i.premium_request_id==e)if(0==a.error_no){var r=a.result.order_info.box_price,s=a.result.order_info,n=a.result.discount_info,m=a.result.dish_activity_quantity||0;listener.trigger("cart.premium","success",{prices:s,discounts:n,actNum:m}),t.updateLocalCart(r)}else popup.open(a.error_msg)},function(){})}})});
;define("mwaimai:widget/shopmenu/category/category.js",function(t,e,i){"use strict";var n=t("mwaimai:static/utils/stat.js"),a=t("mwaimai:static/utils.js"),o="#shopmenu-list?scrollTo",c="#shopmenu-list?getShowGroupId",s=4.84*parseInt(document.querySelector("html").style.fontSize,10)+43+50;i.exports=Widget.extend({el:"#shopmenu-category",events:{"click [data-node=categoryItem]":"doChangeMenu"},init:function(t){this._initPageCount(t),$("#widget-shopcomment-jumpTip").length>0&&(this.jumpTipHeight=parseInt($("#widget-shopcomment-jumpTip").height())),this._initCeiling(t),this._updateActiveTap()},_initPageCount:function(){s=$("#widget-shopcomment-jumpTip").length>0?7.398*parseFloat(document.querySelector("html").style.fontSize)+43+3:7.398*parseFloat(document.querySelector("html").style.fontSize),$("#shopmenu-category").css({top:s})},_initCeiling:function(){var t=this;this.ceilingMount(),$(window).on("scroll",function(){t.ceilingMount(),t.menuTabChanged||t._updateActiveTap()})},_updateActiveTap:function(){var t=this;WidgetManager.communicate({url:c,success:function(e){t.cache_index!=e&&(t.activeTabByIndex(e),t.cache_index=e)}})},ceilingMount:function(){$(window).scrollTop();$("#shopmenu-category").css({top:s})},activeTabByIndex:function(t){var e=this.$el.find('li[data-index="'+t+'"]');this.$el.find("li").removeClass("active"),e.addClass("active"),this._moveTab(t,e.height())},doChangeMenu:function(t){var e=$(t.currentTarget),i=e.data("index");this.jumpToIndex(i)},jumpToIndex:function(t){var e=this;e.activeTabByIndex(t),e.menuTabChanged=!0;var i=function(){e.menuTabChanged=!1};WidgetManager.communicate({url:o,data:[t,i]}),this._doStat()},_doStat:function(){var t=a.getParams(window.location.href),e=t.shop_id;n.addStat("SAK",{da_trd:"waimai",da_src:"MwaimaiShopMenuPg.CartBk.AnchorBtn",da_act:"click",shop_id:e})},_moveTab:function(t){var e=this._getTabUpLength(t);this.$el.scrollTop(e)},_getTabUpLength:function(t){for(var e=0,i=this.$el.find(".list-group li"),n=0;n<Number(t);n++)e+=$(i[n]).height();return e},_getTabDownLength:function(t){for(var e=0,i=this.$el.find(".list-group li"),n=Number(t);n<i.length;n++)e+=$(i[n]).height();return e}})});
;define("mwaimai:widget/shopmenu/featureBox/featureBox.js",function(require,exports,module){var featureTpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';if(eval(_template_varName),_template_fun_array.push('<div class="multi" id="multi"><div class="multi-content"><div class="close"></div><div class="multi-title">',"undefined"==typeof menuData.name?"":baidu.template._encodeHTML(menuData.name),"</div> <div>"),""!=attrData){_template_fun_array.push('<div class="" style="float:left;padding-top:5px">规格:</div><div class="multi-name feature"><span>');for(var i=0,len=attrData.length,item;len>i&&(item=attrData[i]);i++)_template_fun_array.push(""),item.left_num>0?(_template_fun_array.push('<i data-node="attrName" class="attrName '),0==i&&_template_fun_array.push("selected"),_template_fun_array.push('"><a>',"undefined"==typeof item.name?"":baidu.template._encodeHTML(item.name),'</a><input type="hidden" class="id-hidden" value="',"undefined"==typeof item.id?"":baidu.template._encodeHTML(item.id),'"><input type="hidden" class="attrid-hidden" value="',"undefined"==typeof item.dish_attr_id?"":baidu.template._encodeHTML(item.dish_attr_id),'"><input type="hidden" class="price-hidden" value="',"undefined"==typeof item.price?"":baidu.template._encodeHTML(item.price),'"><input type="hidden" class="num-hidden" value="',"undefined"==typeof item.left_num?"":baidu.template._encodeHTML(item.left_num),'" ></i>')):_template_fun_array.push('<i class="attrName" data-node="unchoose"style="color:#ccc"><a>',"undefined"==typeof item.name?"":baidu.template._encodeHTML(item.name),"</a></i>"),_template_fun_array.push("");_template_fun_array.push("</span></div>")}if(_template_fun_array.push("</div><div>"),featureDatas&&""!=featureDatas){_template_fun_array.push("");for(var i in featureDatas){_template_fun_array.push('<div class="" style="float:left;padding-top:7px;"><span>',"undefined"==typeof featureDatas[i].name?"":baidu.template._encodeHTML(featureDatas[i].name),': </span></div><div class="multi-name feature"><span>');for(var j in featureDatas[i].dish_features_data)_template_fun_array.push('<i data-node="featureName" class="featureName '),0==j&&_template_fun_array.push("selected"),_template_fun_array.push('"><a>',"undefined"==typeof featureDatas[i].dish_features_data[j].name?"":baidu.template._encodeHTML(featureDatas[i].dish_features_data[j].name),'</a><input type="hidden" class="id-hidden feature" value="',"undefined"==typeof featureDatas[i].dish_features_data[j].id?"":baidu.template._encodeHTML(featureDatas[i].dish_features_data[j].id),'"><input type="hidden" class="name-hidden feature" value="',"undefined"==typeof featureDatas[i].dish_features_data[j].name?"":baidu.template._encodeHTML(featureDatas[i].dish_features_data[j].name),'"></i>');_template_fun_array.push("</span></div>")}_template_fun_array.push("")}_template_fun_array.push('</div><div class="multi-name"><span>单价: </span><span data-node=\'attrPrice\' style="color: red">￥'),""!=attrData?_template_fun_array.push("","undefined"==typeof attrData[0].price?"":baidu.template._encodeHTML(attrData[0].price),""):_template_fun_array.push("","undefined"==typeof menuData.current_price?"":baidu.template._encodeHTML(menuData.current_price),""),_template_fun_array.push('</span></div><div class="multi-name"><span>数量: </span><span>        <i class="icon-minus" data-node="box-minus"></i>        <span class="box-count"></span><i class="icon-plus selected" data-node="box-plus"></i></span><span data-node="multi-left-num" class=\'multi-left-num\'>库存<a></a>份</span>'),menuData.min_order_number>1&&_template_fun_array.push('<span style="color:#ccc">&nbsp;&nbsp;',"undefined"==typeof menuData.min_order_number?"":baidu.template._encodeHTML(menuData.min_order_number),"份起订</span>"),_template_fun_array.push('</div><div class="multi-btn" data-node= "add-to-cart" data-item="',"undefined"==typeof dataBox?"":baidu.template._encodeHTML(dataBox),'"><span>加入购物车</span></div></div></div><div class="multi-mark" data-node="multi-mark"></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],getCartItem=require("mwaimai:static/utils/CartDataCenter.js"),$box=null,boxCount=1,show=function(e,t){$box=$(featureTpl(t)),e.after($box),$box.find(".multi-left-num").addClass("multi-hide");var a=parseInt($box.find(".attrName.selected .num-hidden").val()),n=($box.find(".attrName.selected .id-hidden").val(),t.featureDatas);""!=n?setShowNoAttr(t,a):setShowAttr(t,a),setEvent(t)},setShowNoAttr=function(e){for(var t=[],a=$box.find(".featureName.selected .id-hidden.feature"),n=e.featureDatas,i=0;i<a.length;i++)t.push(a[i].value);var d=$box.find(".attrName.selected .id-hidden").val();if(d){t=d+"_"+t.sort().join("_");var r=parseInt($box.find(".attrName.selected .num-hidden").val()),o=setMinnumber(e.dataBox,t,n),u=o.count,m=o.countOne,s=o.countMulti;50>r-u&&void 0==m&&void 0==s&&($(".multi-left-num").removeClass("multi-hide"),$(".multi-left-num").find("a").text(r),$(".box-count").html(e.dataBox.minOrderNumber<=r?e.dataBox.minOrderNumber:"0")),50>r-u&&void 0==m&&void 0!=s&&($(".multi-left-num").removeClass("multi-hide"),$(".multi-left-num").find("a").text(r-u),$(".box-count").html(e.dataBox.minOrderNumber<=r-u?e.dataBox.minOrderNumber:"0")),50>r-u&&void 0!=m&&void 0!=s&&($(".multi-left-num").removeClass("multi-hide"),$(".multi-left-num").find("a").text(r-u),$(".box-count").html(r-u==0?"0":"1")),r>=50&&void 0==m&&$(".box-count").html(e.dataBox.minOrderNumber<=r?e.dataBox.minOrderNumber:"0"),r>=50&&void 0!=m&&m>=e.dataBox.minOrderNumber&&$(".box-count").html("1")}else{t=e.dataBox.itemId+"_"+t.sort().join("_");var r=parseInt(e.dataBox.leftNum),o=setMinnumber(e.dataBox,t,n,""),u=o.count,m=o.countOne,l=o.countFeature;50>r-u&&void 0==m&&void 0==l&&($(".multi-left-num").removeClass("multi-hide"),$(".multi-left-num").find("a").text(r-u),$(".box-count").html(e.dataBox.minOrderNumber<=r-u?e.dataBox.minOrderNumber:"0")),50>r-u&&void 0==m&&void 0!=l&&($(".multi-left-num").removeClass("multi-hide"),$(".multi-left-num").find("a").text(r-u),$(".box-count").html(e.dataBox.minOrderNumber<=r-u?e.dataBox.minOrderNumber:"0")),50>r-u&&void 0!=m&&void 0!=l&&($(".multi-left-num").removeClass("multi-hide"),$(".multi-left-num").find("a").text(r-u),$(".box-count").html(r-u==0?"0":"1")),r>=50&&void 0==m&&$(".box-count").html(e.dataBox.minOrderNumber<=r?e.dataBox.minOrderNumber:"0"),r>=50&&void 0!=m&&m>=e.dataBox.minOrderNumber&&$(".box-count").html("1")}},setShowAttr=function(e,t){var a=$box.find(".attrName.selected .id-hidden").val(),n=a,i=(e.featureDatas,setMinnumber(e.dataBox,n,"",a));i&&Number(i)>=Number(e.dataBox.minOrderNumber)?(t&&Number(t-i)<50&&($(".multi-left-num").removeClass("multi-hide"),$(".multi-left-num").find("a").text(t-i)),$(".box-count").html(t-i==0?"0":"1")):($(".box-count").html(e.dataBox.minOrderNumber),t&&50>t&&($(".multi-left-num").removeClass("multi-hide"),$(".multi-left-num").find("a").text(t)),$(".box-count").html(t<e.dataBox.minOrderNumber?"0":e.dataBox.minOrderNumber))},setMinnumber=function(e,t,a,n){var i,n=$box.find(".attrName.selected .id-hidden").val();i=n?n:e.itemId;var d=getCartItem.getCartData();if(n&&""==a){for(var r=0,o=d.items.length;o>r;r++)if(d.items[r].itemId==i)var u=d.items[r].itemCount;return u}if(n&&""!=a){for(var u=0,r=0,o=d.items.length;o>r;r++)if(d.items[r].itemId==i){var m=d.items[r].itemCount;if(d.items[r].itemId_feature==t)var s=d.items[r].itemCount;u+=parseInt(d.items[r].itemCount)}return{count:u,countOne:s,countMulti:m}}if(!n&&""!=a){for(var u=0,r=0,o=d.items.length;o>r;r++)if(d.items[r].itemId==i){var l=d.items[r].itemCount;if(d.items[r].itemId_feature==t)var s=d.items[r].itemCount;u+=parseInt(d.items[r].itemCount)}return{count:u,countOne:s,countFeature:l}}},dismiss=function(){$box&&(boxCount=1,$box.remove(),$box=null)},setEvent=function(e){e.dataBox.minOrderNumber;$box.on("click",".close",function(){dismiss()}),$box.on("click","[data-node = attrName]",function(t){var a=$(t.currentTarget);boxCount=1,$("[data-node = attrName]").removeClass("selected"),a.toggleClass("selected",!0),$(".multi-left-num").addClass("multi-hide");var n=e.featureDatas,i=parseInt($box.find(".attrName.selected .num-hidden").val()),d=a.find(".price-hidden").val();$("[data-node=attrPrice]").text("￥"+d),""==n?setShowAttr(e,i):setShowNoAttr(e,i)}),$box.on("click","[data-node = featureName]",function(t){var a=$(t.currentTarget);boxCount=1,a.parents(".multi-name").find("[data-node = featureName]").removeClass("selected"),a.toggleClass("selected",!0);{var n=parseInt($box.find(".attrName.selected .num-hidden").val());$box.find(".attrName.selected .id-hidden").val()}setShowNoAttr(e,n)}),$box.on("click","[data-node = box-plus]",function(){if(0!=$(".box-count").html()){var t=$box.find(".attrName.selected .id-hidden").val(),a=$box.find(".attrName.selected .num-hidden").val();if(t){if(this.minorderNotone==a)return}else if(this.minorderNotone==e.menuData.left_num)return;var n=parseInt($(".box-count").html());if(null!=$(".multi-hide").text())var i=a;else var i=parseInt($(".multi-left-num").find("a").text());i&&i>n&&(n++,boxCount++),i||0==i||(n++,boxCount++),$("[data-node = box-minus]").addClass("selected"),$(".box-count").html(n)}}),$box.on("click","[data-node = box-minus]",function(){if(0!=$(".box-count").html()){for(var t=[],a=$box.find(".featureName.selected .id-hidden.feature"),n=e.featureDatas,i=0;i<a.length;i++)t.push(a[i].value);var d=$box.find(".attrName.selected .id-hidden").val();if(d){t=d+"_"+t.sort().join("_");{parseInt($box.find(".attrName.selected .num-hidden").val())}}else{t=e.dataBox.itemId+"_"+t.sort().join("_");{e.dataBox.leftNum}}if(d&&""==n){var r=setMinnumber(e.dataBox,"",n,d);if(!r||r<e.dataBox.minOrderNumber){var o=$(".box-count").html();if(o--,o==e.dataBox.minOrderNumber+1||o==e.dataBox.minOrderNumber-1||o==e.dataBox.minOrderNumber)return $("[data-node = box-minus]").removeClass("selected"),o=e.dataBox.minOrderNumber,boxCount=1,void $(".box-count").html(e.dataBox.minOrderNumber);boxCount--,$(".box-count").html(o)}else{if(2==boxCount||1==boxCount)return $("[data-node = box-minus]").removeClass("selected"),boxCount=1,void $(".box-count").html("1");boxCount--,$(".box-count").html(boxCount)}}if(!d&&""!=n){var r=setMinnumber(e.dataBox,t,n,"").count,u=setMinnumber(e.dataBox,t,n,"").countOne;if(!u||u<e.dataBox.minOrderNumber){var o=$(".box-count").html();if(o--,o==e.dataBox.minOrderNumber+1||o==e.dataBox.minOrderNumber-1||o==e.dataBox.minOrderNumber)return $("[data-node = box-minus]").removeClass("selected"),o=e.dataBox.minOrderNumber,boxCount=1,void $(".box-count").html(e.dataBox.minOrderNumber);boxCount--,$(".box-count").html(o)}else{if(2==boxCount||1==boxCount)return $("[data-node = box-minus]").removeClass("selected"),boxCount=1,void $(".box-count").html("1");boxCount--,$(".box-count").html(boxCount)}}if(d&&""!=n){var r=setMinnumber(e.dataBox,t,n,d).count,u=setMinnumber(e.dataBox,t,n,d).countOne;if(!u||u<e.dataBox.minOrderNumber){var o=$(".box-count").html();if(o--,o==e.dataBox.minOrderNumber+1||o==e.dataBox.minOrderNumber-1||o==e.dataBox.minOrderNumber)return $("[data-node = box-minus]").removeClass("selected"),o=e.dataBox.minOrderNumber,boxCount=1,void $(".box-count").html(e.dataBox.minOrderNumber);boxCount--,$(".box-count").html(o)}else{if(2==boxCount||1==boxCount)return $("[data-node = box-minus]").removeClass("selected"),boxCount=1,void $(".box-count").html("1");boxCount--,$(".box-count").html(boxCount)}}}}),$box.on("click","[data-node = add-to-cart]",function(){commitMulti(e)}),$($box[1]).on("click",function(){dismiss()})},commitMulti=function(e){if(0==$(".box-count").html())return void dismiss();var t,a,n,i,d,r=e.dataBox,o=$box.find(".attrName.selected a").text(),u=$box.find(".attrName.selected .id-hidden").val(),m=$box.find(".attrName.selected .attrid-hidden").val(),s=$box.find(".attrName.selected .num-hidden").val(),l=$(".attrName.selected").find(".price-hidden").val();i=m?u:r.itemId,n=m?s:r.leftNum,t=m?l:r.itemPrice,a=m?r.itemName+"("+o+")":r.itemName;for(var f=$box.find(".featureName.selected .id-hidden.feature"),c=$box.find(".featureName.selected .name-hidden.feature"),b=[],x=[],p=0;p<f.length;p++)b.push(f[p].value);for(var p=0;p<c.length;p++)x.push(c[p].value);if(b)var d=i+"_"+b.sort().join("_");else var d=i;r={selectFeatures:b,featureNames:x,itemId:i,itemId_feature:d,itemName:a,itemPrice:t,packCount:r.packCount,packPrice:r.packPrice,minOrderNumber:r.minOrderNumber||1,leftNum:n,sourceName:r.sourceName,dish_activity_obj:r.dish_activity_obj||0};var _=$(".attrName").attr("data-node");for(boxCount;boxCount>0;boxCount--)("unchoose"!=_||null!=o)&&listener.trigger("shopmenu.list","click_plus",r);dismiss()};module.exports={show:show,dismiss:dismiss}});
;define("mwaimai:widget/shopmenu/list/list.js",function(t,e,i){{var a=5,r=4.84*parseInt(document.querySelector("html").style.fontSize,10)+43+50,n=t("mwaimai:static/utils/stat.js"),s=t("mwaimai:static/utils.js"),o=t("mwaimai:comp/popup/popup.js"),d=t("mwaimai:widget/shopmenu/featureBox/featureBox.js");t("mwaimai:static/platformInvoke/invoke.js")}i.exports=Widget.extend({el:"#shopmenu-list",events:{"click .item-add .-plus":"_doClickPlus","click .item-add .-minus":"_doClickMinus","click .item-multi":"_doClickMulti"},channels:{"datacenter.cart ready":"_renderCart","datacenter.cart.shopmenu.list getCartCenter":"_safeUpdateAsync"},init:function(t){var e=this,i=e.$el=$(e.el);e.initState=!1,this.sourceNameBox=t.source_info.source_name,this.menu=t.takeout_menu,r=$("#widget-shopcomment-jumpTip").length>0?7.398*parseFloat(document.querySelector("html").style.fontSize)+43+3:7.398*parseFloat(document.querySelector("html").style.fontSize),e.categoryTop=[],i.find(".listgroup").each(function(t,i){e.categoryTop.push($(i).offset().top+$(i).height())}),n.addStat("SAK",{da_trd:"waimai",da_src:"MwaimaiShopMenuPg",da_act:"show"}),this.$el.css({top:r}),$(".lazy-div").lazyload({data_attribute:"url"}),$("#widget-shopcomment-jumpTip").length>0&&(this.jumpTipHeight=parseInt($("#widget-shopcomment-jumpTip").height())),this.addToCart(),e.initState=!0,this._hideSameEle()},_hideSameEle:function(){for(var t=new Object,e=$("li.list-item[data-item]"),i=0;i<e.length;i++){var a=JSON.parse(e.eq(i).attr("data-item"));t[a.itemId]?e.eq(i).remove():t[a.itemId]=!0}},_renderCart:function(t,e){var i,a,r,n=this.$el.find("li.list-item"),s=e.items;n.each(function(){r=$(this),i=r.data("item"),a=0;for(var t=0,e=s.length;e>t;t++)if(i.itemId===s[t].itemId){a=s[t].itemCount;break}"baidu"==i.sourceName&&parseInt(a)>=parseInt(i.leftNum)?r.find(".-plus").addClass("disable"):r.find(".-plus").removeClass("disable"),r.find(".item-count").html(a),a>0?r.find(".item-add").addClass("show-all"):r.find(".item-add").removeClass("show-all")})},_doClickPlus:function(t){n.addStat("SAK",{da_trd:"waimai",da_src:"MwaimaiShopMenuPg.ListBk.PlusBtn",da_act:"click"});var e=$(t.currentTarget).parent();e.addClass("show-all"),s.isAndroid()?this.addCartAnimate():this.addProductFly(t),listener.trigger("shopmenu.list","click_plus",e.parents("li.list-item").data("item"))},_doClickMinus:function(t){n.addStat("SAK",{da_trd:"waimai",da_src:"MwaimaiShopMenuPg.ListBk.MinusBtn",da_act:"click"});{var e=$(t.currentTarget).parent();Number(e.find(".item-count").html())}listener.trigger("shopmenu.list","click_minus",e.parents("li[data-item]").data("item"))},_doClickMulti:function(t){var e=$(t.currentTarget),i=e.parents(".list-item"),a=this.getMultiMenuData(i),r=this.getMultiBoxData(a),n=a.dish_attr,s=a.dish_features,o={menuData:a,attrData:n,featureDatas:s,sourceNameBox:this.sourceNameBox,dishActivityBox:this.dishActivityBox,dataBox:r};d.show(this.$el,o)},getMultiBoxData:function(t){var e={itemId:t.item_id,itemName:t.name,itemPrice:t.current_price,packCount:t.packge_box_number,packPrice:t.packge_box_price,minOrderNumber:t.min_order_number,leftNum:t.left_num,sourceName:this.sourceNameBox,dish_activity_obj:t.dish_activity};return e},getMultiMenuData:function(t){var e=t.find(".item-multi").attr("data-countUp"),i=t.find(".item-multi").attr("data-count"),a=this.menu[e].data[i];return a},_doChangePrice:function(t){var e=$(t.currentTarget),i=e.find("input").val();$("[data-node=attrPrice]").text(i)},_safeUpdateAsync:function(t,e){var i=e.cartCenter,a=(new Date).getTime();this.premium_request_id=a,this._requestPremium(i,a)},_requestPremium:function(t,e){var i=this,a=t.updatePremiumAsync;a(function(a){if(i.premium_request_id==e&&0==a.error_no){var r=a.result.order_info.box_price,n=a.result.order_info,s=a.result.discount_info,o=a.result.dish_activity_quantity||0;listener.trigger("cart.premium","success",{prices:n,discounts:s,actNum:o}),t.updateLocalCart(r)}},function(){})},scrollTo:function(t,e){if(t){for(var i=this.$el.find(".listgroup"),n=0,s=0;s<Number(t);s++)n+=$(i[s]).height();var o=r+n+a;frameAnimate({expectedTime:200,maxEndureTime:400,startMeasure:$(window).scrollTop(),targetMeasure:o,applyMeasure:function(t){$(window).scrollTop(t)},endAction:e})}},getShowGroupId:function(){for(var t=$(window).scrollTop()-r,e=this.$el.find(".listgroup"),i=0,a=0;a<e.length;a++){var n=$(e[a]),s=n.height();if(i+=s,i>t)break}return a},addToCart:function(t){if(t=t||s.getParams().dish||""){var e=$(".list-item"+t).eq(0);setTimeout(function(){if(e.length){e.css("box-shadow","0 0 10px rgba(0, 0, 0, 0.4) inset");var t=e.offset().top-r-100,i=e.find(".-plus");$("body").scrollTop(t>0?t:0),i.animate({"box-shadow":"0 0 60px rgba(255, 0, 0, 0.5) inset"},300,"easeInCirc",function(){$(this).trigger("click"),$(this).animate({"box-shadow":"0 0 0 rgba(255, 0, 0, 0.5) inset"},800,"easeOutQuart",function(){e.css("box-shadow","")})})}else o.open("请看看其他菜品～")},1e3)}},addProductFly:function(t){var e=this,i=$('<span class="u-flyer" />');i.fly({start:{left:t.pageX-20,top:t.clientY-30},end:{left:20,top:window.innerHeight-20,width:20,height:20},speed:2.8,onEnd:function(){this.destroy(),e.addCartAnimate()}})},addCartAnimate:function(){var t=$(".row-num");t.addClass("shopCartAnimate"),t.on("webkitAnimationEnd",function(){t.removeClass("shopCartAnimate")})}})});
;define("mwaimai:static/js/page/shopmenu.js",function(i,t,s){var a=i("mwaimai:static/utils/CartDataCenter.js");s.exports={init:function(i){var i=i||{},t=i.bussiness_status;1!=t&&a.init(i)}}});